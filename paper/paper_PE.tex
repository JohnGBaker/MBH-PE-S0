\documentclass[aps,showpacs,twocolumn,prd,superscriptaddress,nofootinbib]{revtex4-1}

\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{latexsym}
\usepackage{graphicx}
\usepackage{bm}
%\usepackage{color}
\usepackage{enumerate}
\usepackage{ulem}
\usepackage{tabularx}
\usepackage{braket}

\usepackage{color}
\usepackage[usenames,dvipsnames,svgnames,table]{xcolor}
%\usepackage[colorlinks=true,
%            linkcolor=green,
%            urlcolor=blue,
%            citecolor=red]{hyperref}
\usepackage[colorlinks=true,
            linkcolor=YellowOrange,
            urlcolor=RoyalBlue,
            citecolor=RedViolet]{hyperref}

\newcommand{\be}{\begin{equation}}
\newcommand{\ee}{\end{equation}}
\newcommand{\bsub}{\begin{subequations}}
\newcommand{\esub}{\end{subequations}}
\newcommand\ud{{\mathrm{d}}}
\newcommand\uD{{\mathrm{D}}}
\newcommand\calO{{\mathcal{O}}}
\newcommand\calM{{\mathcal{M}}}
\newcommand\calF{{\mathcal{F}}}
\newcommand\calT{{\mathcal{T}}}
\newcommand\calD{{\mathcal{D}}}
\newcommand\calA{{\mathcal{A}}}
\newcommand\calL{{\mathcal{L}}}
\newcommand\bfx{\mathbf{x}}
\newcommand{\ov}[1]{\overline{#1}}
\newcommand{\ph}[1]{\phantom{#1}}
\newcommand{\cte}{\mathrm{cte}}
\newcommand{\nn}{\nonumber}
\newcommand{\hatk}{\hat{k}}
\newcommand{\SNR}{\,\mathrm{SNR}}
\newcommand{\Hz}{\,\mathrm{Hz}}
\newcommand{\mHz}{\,\mathrm{mHz}}
\newcommand{\au}{\,\mathrm{au}}
\newcommand{\sinc}{\,\mathrm{sinc}}
\newcommand{\Msol}{M_{\odot}}
\newcommand{\Mchirp}{M_{c}}
\newcommand\betaL{{\beta_{L}}}
\newcommand\lambdaL{{\lambda_{L}}}
\newcommand\varphiL{{\varphi_{L}}}
\newcommand\psiL{{\psi_{L}}}
\newcommand{\tf}{t_{f}}
\newcommand{\Tf}{T_{f}}
\newcommand{\tfd}{t_{f}^{d}}
\newcommand{\tfSPA}{t_{f}^{\rm SPA}}
\newcommand{\TfSPA}{T_{f}^{\rm SPA}}
\newcommand{\sYlm}{{}_{-2}Y_{\ell m}}
\newcommand{\sYlmstar}{{}_{-2}Y_{\ell m}^{*}}
\newcommand{\sYlminusmstar}{{}_{-2}Y_{\ell, -m}^{*}}

\newcolumntype{C}[1]{>{\centering\arraybackslash}p{#1}}
\newcolumntype{L}[1]{>{\raggedright\arraybackslash}p{#1}}

\newcommand{\SM}[1]{{\color{Blue} [SM: #1]}}
\newcommand{\JGB}[1]{{\color{DarkGreen} [JGB: #1]}}
\newcommand{\TDC}[1]{{\color{red} [TDC: #1]}}

\begin{document}

%\title{Bayesian methods for black hole merger parameter estimation with LISA.}
\title{Exploring Bayesian parameter estimation of binary black holes with LISA}

\author{Sylvain Marsat}
\affiliation{APC, AstroParticule et Cosmologie, Universit\'{e} Paris Diderot, CNRS/IN2P3, CEA/Irfu, Observatoire de Paris, Sorbonne Paris Cit\'{e}, 10, rue Alice Domon et L\'{e}onie Duquet 75205 PARIS Cedex 13, France}
\author{John G. Baker}
\affiliation{Gravitational Astrophysics Laboratory, NASA Goddard Space Flight Center, 8800 Greenbelt Rd., Greenbelt, MD 20771, USA}
\author{Tito Dal Canton}
\thanks{NASA Postdoctoral Program fellow}
\affiliation{Gravitational Astrophysics Laboratory, NASA Goddard Space Flight Center, 8800 Greenbelt Rd., Greenbelt, MD 20771, USA}


\date{\today}

\begin{abstract}

The space-based gravitational wave detector LISA will observe mergers of supermassive black hole binary systems (SMBHs) to cosmological distances, as well as inspiralling stellar-origin (or stellar-mass) binaries (SOBHs) years before they enter the LIGO/Virgo band. Much remains to be explored for the parameter recovery of both class of systems. Previous SMBH analyses relied on inspiral-only signals and/or a simplified Fisher matrix analysis, while SOBHs have not yet been analyzed with Bayesian methods. We accelerate likelihood computations by (i) using a Fourier-domain response of the LISA instrument, (ii) using a reduced-order model for non-spinning waveforms that include a merger-ringdown and higher harmonics, (iii) setting the noise realization to zero and computing overlaps in the amplitude/phase representation. We present the first simulations of Bayesian inference for the parameters of supermassive black hole systems including consistently the merger and ringdown of the signal, as well as higher harmonics. We find that restricting the merger-dominated signal to its dominant harmonic can make the extrinsic likelihood very degenerate. Including higher harmonics proves to be crucial to break degeneracies and considerably improves the localization of the source, with a surviving bimodality in the sky position. We also present the first simulations of Bayesian inference for SOBHs, and show that although unimodal, their posterior distributions can have non-Gaussian features.

\end{abstract}

\pacs{
04.70.Bw, % classical black holes
04.80.Nn, % Gravitational wave detectors and experiments
95.30.Sf, % relativity and gravitation
95.55.Ym, % Gravitational radiation detectors
97.60.Lf  % black holes (astrophysics)
}

\maketitle

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Introduction}
\label{sec:intro}

%The future gravitational wave detector LISA~\cite{LISA2017}.
%
%, the network of ground-based detectors will have expanded from the current LIGO~\cite{} and Virgo~\cite{} detectors to include KAGRA~\cite{} and Indigo, which will have continued improving their sensitivity. By the time LISA will fly, a third generation of detectors, like Einstein Telescope~\cite{} and Cosmic Explorer~\cite{}, might be operating.
%
%LISA will provide complementary informations. By targeting a much lower frequency band, will be sensitive to different sources. Among the sources, mergers of SMBHs, seen at high SNR and anywhere in the observable universe, and inspirals of LIGO-type sources (SOBHs), opening the possibility of multi-band gravitational wave astronomy.
%
%Much remained to be explored for the data analysis of LISA. Different challenges : high SNR for merger-dominated SMBH signals, SNR-limited regime for very long SOBH signals. The motion of the detector leaves an imprint on the signal, while the response also has frequency-dependency at high frequencies where the long-wavelength approx is not valid anymore. Finally, many other challenges : calibration and understanding noise on the fly, non-stationarity of the noise, dealing with glitches, and most importantly global fit: superposition of long-lived sources in a single datastream.

Gravitational waves from the coalescence of black hole binaries are routinely observed \cite{GWTC-1} by the ground-based interferometers Advanced LIGO \cite{LIGO}, Advanced Virgo \cite{Virgo} and, soon, KAGRA \cite{KAGRA}.

Ground-based interferometers are fundamentally limited at low frequency by terrestrial noise, and cannot be used to study mergers of compact objects much heavier than $\approx 10^3 \Msol$.
The LISA mission \cite{LISA2017} is designed to overcome this limitation, enabling the observation and precise characterization of mergers of black holes ranging in mass from tens of $\Msol$ (stellar-origin black holes, SOBH) to millions of $\Msol$ (supermassive black holes, SMBH).
Black hole mergers, in fact, will be a major class of sources in the LISA frequency band.

In order to realize the full scientific objective of LISA with respect to black hole mergers, adequate data analysis tools must be prepared in advance.
Similarly to what happens in LIGO and Virgo, one has to first identify the presence of a merger waveform in the LISA data, and then infer the distribution of the physical parameters of its source from the data, enabling the construction of a catalog of black hole mergers.
Inferring the parameters of binaries, in particular their distance and sky location, will also be necessary to organize multimessenger observations of their late inspirals and mergers \cite{TAP-LISA} and for multiband gravitational-wave astronomy \cite{Sesana16}.
In this paper we focus on the latter part of the analysis problem, i.e.~the inference of the black hole parameters from the LISA data, once we have reasons to believe the presence of the signal in the data.

The inference problem amounts to produce samples from the posterior distribution for sourcee parameters, related by Baye's theroem to the likelihood function, i.e.~the probability of observing the measured data given the source parameters and a model of the source and detector.
In LISA, this problem is more complex than in kilometer-scale ground-based interferometers.
Depending on the masses and spins of the black holes, additional challenges arises from the much larger expected signal-to-noise ratios (SNRs) for high-mass systems, or the much longer duration of the waveform for low-mass systems. For SMBHBs, the large SNR will require a very accurate modeling of the waveform, including the merger and ringdown regimes, the effects of spin and corrections of higher harmonics in the signal beyond the quadrupole.

The response of the LISA instrument to a given waveform shows a time- and frequency-dependence.
Contrary to LIGO and Virgo, which are approximately fixed in an inertial frame during the observation of any merger, the LISA constellation will move around the Sun and change its orientation appreciably during the observation of a large fraction of the inspirals, leading to additional modulations of the signals.
Furthermore, due to the LISA arm length, for many sources the long-wavelength approximation will not hold, which introduces a frequency-dependence in the response. As we will see in this study, a proper treatment of these effects is necessary in order to understand degeneracies between the source parameters.

Previous parameter recovery studies with LISA

\TDC{Add literature review on BBH PE here, can base on GOAT study.}

Here we demonstrate that standard Bayesian inference can be performed for SMBHs and SOBHs using a self-consistent waveform model that includes inspiral, merger, ringdown and higher-order modes (albeit neglecting spins) and a full model of the LISA response.
We start by introducing a fast method to calculate the likelihood for a black hole merger.
The method includes: a fast computation of a Fourier-domain inspiral-merger-ringdown waveform with higher-order modes based on reduced-order modeling; a fast Fourier-domain computation of the LISA response based on \cite{MB18}; and a fast method for computing the noise-weighted product between waveforms.
We couple our likelihood with two codes for Bayesian inference based on different sampling techniques, constructing an inference engine which allows us to perform a variety of investigations with simulated black hole mergers.
Both samplers are first shown to converge to comparable posterior distributions of the source parameters for a few case studies, and we highlight the challenges we encounter in the sampling.
The full posterior distributions are then compared with their Fisher approximations, widely used in gravitational-wave analyses.
Focusing on massive black holes, we show next the effect of higher-order modes on the degeneracies between some of the parameters.
We derive an analytic and intuitive explanation of the origin of such degeneracies via various approximations.
We show examples of how the posterior distributions evolve over time as more and more data becomes available for the inference.
Finally, we repeat some of our investigations for stellar-origin black hole mergers as well.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{LISA instrument response}
\label{sec:response}

\SM{add mini-intro}

We will use units with $G=c=1$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{The GW signal}
\label{sec:gwsignal}

To describe the gravitational wave signal, we first need to define a conventional source frame associated to the binary system, as detailed in App.~\ref{app:conventions}. The gravitational wave propagation vector $k$, pointing from the source to the observer, has polar angles $(\iota, \varphi)$ in this source frame. Next, one introduces polarization vectors $p$, $q$ so that $(p, q, k)$ is a direct triad. The precise choice of $(p,q)$ is a matter of convention, for which we refer to App.~\ref{app:conventions}.

The gravitational waveform in the transverse-traceless gauge is described by the two polarizations $h_{+}$, $h_{\times}$. If $H_{ij} = h_{ij}^{\rm TT}$ represents the gravitational wave signal in matrix form,
\be
	H = h_{+} P_{+} + h_{\times} P_{\times}
\ee
with the polarization tensors
\bsub
\begin{align}
	P_{+} &= p \otimes p - q \otimes q \,,\\
	P_{\times} &= p \otimes q + q \otimes p \,.
\end{align}
\esub
Conversely, the polarizations are
\bsub
\begin{align}
	h_{+} &= \frac{1}{2} \left(p \otimes p - q \otimes q \right) : H \,,\\
	h_{\times} &= \frac{1}{2} \left( p \otimes q + q \otimes p \right) : H \,,
\end{align}
\esub
with the notation $A : B = A_{ij}B_{ij}$.

One can further decompose the gravitational wave signal, seen as a function of the direction of emission $(\iota, \varphi)$ in the source frame, in spin-weighted spherical harmonics as
\be\label{eq:apphpcmodes}
	h_{+} - i h_{\times} = \sum_{\ell \geq 2} \sum_{m = -\ell}^{\ell} {}_{-2}Y_{\ell m} (\iota, \varphi) h_{\ell m} \,,
\ee
where the explicit expression of the ${}_{-2}Y_{\ell m}$ is given in~\cite{}. In the following, we will use exclusively this parametrization of the waveform as a set of modes $h_{\ell m}$. The dominant harmonic is $h_{22}$, while the others are called higher modes (HM) or higher harmonics.

We will both generate the waveforms and apply the response directly in the Fourier domain. Our convention for the Fourier transform of a function $F$ is
\be\label{eq:defFourier}
	\tilde{F}(f) = \int dt \; e^{2 i \pi f t} F(t) \,.
\ee
Note that this differs by a change $f\rightarrow -f$ from the more usual convention used e.g. in \texttt{LAL}~\cite{}.

The definition of the reference time and phase \SM{[\dots COMPLETE]}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Mode decomposition and polarization angle}
\label{sec:modespol}

We now translate the mode decomposition~\eqref{eq:hpcmodes} in the Fourier domain. We have
\bsub
\begin{align}
	h_{+} = \frac{1}{2} \sum_{\ell, m} \left( \sYlm h_{\ell m} + \sYlmstar h_{\ell m}^{*} \right) \,,\\
	h_{\times} = \frac{i}{2} \sum_{\ell, m} \left( \sYlm h_{\ell m} - \sYlmstar h_{\ell m}^{*} \right) \,,
\end{align}
\esub
which is valid in general (we dropped the $(\iota, \varphi)$ arguments of the $\sYlm$). Now, for non-precessing binary systems, an exact symmetry relation between modes reads
\be\label{eq:nonprecsymmetry}
	h_{\ell, -m} = (-1)^{\ell} h_{\ell, m}^{*} \,.
\ee
Using this symmetry, we can write
\be
	h_{+,\times} = \sum_{\ell, m} K_{\ell m}^{+, \times} h_{\ell m} \,,
\ee
with
\bsub
\begin{align}
	K_{\ell m}^{+} =\frac{1}{2} \left( \sYlm + (-1)^{\ell} \sYlminusmstar \right) \,,\\
	K_{\ell m}^{\times} = \frac{i}{2} \left( \sYlm - (-1)^{\ell} \sYlminusmstar \right) \,.
\end{align}
\esub

Going to the Fourier domain, an approximation often used is to neglect support for negative/positive frequencies according to
\be\label{eq:approxnegf}
	\tilde{h}_{\ell m} (f) \simeq 0 \;\; \text{for} \;\; m<0, \; f>0 \;\; ( m>0, \; f<0 )\,,
\ee
and neglecting modes $h_{\ell 0}$. We will use this approximation throughout this paper. Note that we picked our Fourier convention~\eqref{eq:defFourier} to ensure that modes $\tilde{h}_{\ell m} (f)$ with $m>0$ have support for $f>0$. Using~\eqref{eq:approxnegf}, for $f>0$ we have
\be
	\tilde{h}_{+,\times} = \sum_{\ell} \sum_{m>0} K_{\ell m}^{+, \times} \tilde{h}_{\ell m} \,.
\ee

Next, it is convenient to introduce mode-by-mode polarization matrices
\be
	P_{\ell m} = P_{+} K_{\ell m}^{+} + P_{\times} K_{\ell m}^{\times} \,,
\ee
so that
\be\label{eq:Hsummodes}
	H = \sum_{\ell, m} P_{\ell m} h_{\ell m} \,.
\ee

The polarization angle $\psi$ can be seen as detailed in App~\ref{app:conventions} as a degree of freedom in the relation between the source frame and the detector frame, parametrizing a rotation around the wave vector $k$. To define this angle, one introduces reference vectors $(u,v)$ orthogonal to $k$, that define the zero of the polarization angle as $(p,q)(\psi=0) = (u,v)$. Our convention for $(u,v)$ is detailed in App~\ref{app:conventions}.

To make explicit the dependence in polarization, we can define polarization tensors for 0 polarization angle as
\bsub
\begin{align}
	P_{+}^{0} &= P_{+}(\psi = 0) = u \otimes u - v \otimes v \,,\\
	P_{\times}^{0} &= P_{\times}(\psi = 0) = u \otimes v + v \otimes u \,.
\end{align}
\esub
This allows to write the dependence in polarization as
\be
	P_{+} + i P_{\times} = e^{-2 i \psi} \left( P_{+}^{0} + i P_{\times}^{0} \right) \,,
\ee
or explicitly in $P_{\ell m}$ as
\begin{align}
	P_{\ell m} (\iota, \varphi, \psi) &= \frac{1}{2} \sYlm(\iota, \varphi) e^{-2 i \psi} \left( P_{+}^{0} + i P_{\times}^{0} \right) \nn\\
	& + \frac{1}{2} (-1)^{\ell} \sYlminusmstar (\iota, \varphi) e^{+2 i \psi} \left( P_{+}^{0} - i P_{\times}^{0} \right) \,.
\end{align}
Writing the $P_{\ell m}$ matrices in this way allows to factor out explicitly all dependencies in the extrinsic parameters $(\iota, \phi, \psi)$. Together with the luminosity distance $D_{L}$ scaling the overall amplitude of the signal, these parameters enter as constant (time and frequency independent) prefactors in the response for each mode $h_{\ell m}$.

Since only $2\psi$ intervenes, the polarization $\psi$ has an exact $\pi$-degeneracy; by convention we set $\psi \in [0,\pi]$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Frequency domain LISA response}
\label{subsec:FDresponse}

The LISA response can be built from single-link observables $y_{slr} = (\nu_{r} - \nu_{s})/\nu$ respresenting a laser frequency shift between the sending spacecraft $s$ and the receiving spacecraft $r$ along the link $l$. We use the expression~\cite{}
\be\label{eq:defyslr}
	y_{slr} = \frac{1}{2} \frac{n_{l} \otimes n_{l}}{1 - k\cdot n_{l}} : \left[ H(t - L - k\cdot p_{s}) - H(t - k\cdot p_{r}) \right] \,,
\ee
with $H$ the transverse-traceless matrix representing the gravitational wave, $L$ the delay along one arm\footnote{We use units with $G=c=1$.}, taken to be fixed, $k$ the propagation vector, $n_{l}$ the link unit vectors (from $s$ to $r$) and $p_{s}$, $p_{r}$ the positions of the spacecrafts. Here $n_{l}$, $p_{s}$ and $p_{r}$ are evaluated at the same time $t$.

In the frequency domain, modes will be represented with their amplitude and phase as\footnote{Note our Fourier convention~\eqref{eq:defFourier}.}
\be\label{eq:hlmampphase}
	\tilde{h}_{\ell m} (f) = A_{\ell m} (f) e^{-i\Psi_{\ell m} (f)}\,.
\ee
We will use the analysis of~\cite{MB18} and write the response in individual observables $y_{slr}$ with a transfer function for each spherical harmonic mode as
\be
	\tilde{y}_{slr} = \sum_{\ell, m}\calT_{slr}^{\ell m}(f) \tilde{h}_{\ell m} \,.
\ee
Applying the perturbative formalism of~\cite{MB18} to leading order, we have simply
\be\label{eq:Tlmslr}
	\calT_{slr}^{\ell m}(f) = G_{slr}^{\ell m}(f, t_{f}^{\ell m}) \,,
\ee
where
\begin{align}\label{eq:Gslr}
	G_{slr}^{\ell m}(f,t) &= \frac{i \pi f L}{2} \sinc \left[ \pi f L\left(1-k\cdot n_{l} \right) \right] \nn\\
	& \quad \cdot \exp\left[ i \pi f \left( L + k\cdot \left( p_{r} + p_{s} \right) \right) \right] \; n_{l} \cdot P_{\ell m} \cdot n_{l} \,,
\end{align}
is the kernel from~\cite{MB18} with $n_{l}$, $p_{s}$, $p_{r}$ evaluated at $t$, with $P_{\ell m}$ defined by the decomposition~\eqref{eq:Hsummodes}. In~\eqref{eq:Tlmslr},
\be\label{eq:deftflm}
	t_{f}^{\ell m} = -\frac{1}{2\pi} \frac{d\Psi_{\ell m}}{df}
\ee
is the effective frequency$\to$time correspondence, defined across the whole frequency band and including the merger and ringdown.

The analysis of~\cite{MB18} has shown that higher-order corrections are small for SMBH systems, as well as for SOBH systems provided they are close enough to merger as will be the case for the examples chosen here. The fact that we use the same Fourier-domain treatment of the transfer functions for both the signal and the templates should also mitigate the importance of modelling errors. We will therefore limit ourselves to the leading order in the treatment of~\cite{MB18} in the rest of this paper.

We note an important feature of~\eqref{eq:Gslr}: frequency-dependent terms only feature the projections
\be
	k_{\parallel} \cdot n_{l}, \; k_{\parallel} \cdot p_{s,r} \,, 
\ee
with $k_{\parallel}$ the projection of the wave vector $k$ in the (instantaneous) LISA plane, thus the frequency-dependent factors are invariant when we reflect $k$ across this plane. This will remain true when constructing TDI variables below\footnote{Strictly speaking it will not be true in the most general response formalism of~\cite{MB18}, where corrections are either slightly non-local in time or involve velocities, that are out of the LISA plane.}. We will investigate sky degeneracies in detail in Sections~\ref{subsec:MBHBPEdegen} and~\ref{subsec:MBHBacctimebreakdegen}.

In~\eqref{eq:defyslr} and~\eqref{eq:Gslr}, one can distinguish two types of delays: on one hand the delay associated to the position $p_{0}$ of the center of the constellation on its oarbit around the Sun, with baseline $R=1 \au$, and on the other hand the delays associated to the individual spacecraft positions in the constellation, with baseline $L=2.5 \cdot 10^{6 }\mathrm{km}$. This defines the transfer frequencies
\bsub\label{eq:transferfrequencies}
\begin{align}
	f_{R} &= 1/R = 2.0\times10^{-3}\Hz \,,\\
	f_{L} &= 1/L = 0.12\Hz \,.
\end{align}
\esub
The transfer frequency $f_{L}$ correspond to fitting a full wavelength in the armlength; as we will see below in Sec.~\ref{}, the long-wavelength approximation starts to break down at significantly lower frequencies.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Time Delay Interferometry}
\label{sec:TDIresponse}

To mitigate laser noise, LISA requires Time Delay Interferometry (TDI)~\cite{}. These TDI observables are built from delayed combinations of the one-arm basic observables~\eqref{eq:defyslr}. Detailed cancellations for a flexing and rotating constellation prompted the development of higher-generation TDI schemes~\cite{}. However, these refinements affect only marginally the response to the gravitational waves. We therefore limit ourselves to first-generation TDI and adopt a rigid approximation for the cancellation, where delays are all constant and set to $L$. Using the notation $y_{slr,L} = y_{slr}(t - L)$, the first-generation TDI Michelson observable $X$ reads~\cite{}
\begin{align}
	X &= y_{31} + y_{13,L} + \left( y_{21} + y_{12,L} \right)_{,2L} \nn\\
	& - \left( y_{21} + y_{12,L} \right) - \left( y_{31} + y_{13,L} \right)_{,2L} \,,
\end{align}
with the other Michelson observables $Y$, $Z$ being obtained by cyclic permutation. Uncorrelated combinations $A$, $E$ and $T$ are then defined as
\bsub
\begin{align}
	A &= \frac{1}{\sqrt{2}} \left( Z - X \right) \,,\\
	E &= \frac{1}{\sqrt{6}} \left( X - 2Y + Z \right) \,,\\
	T &= \frac{1}{\sqrt{3}} \left( X + Y + Z \right) \,.
\end{align}
\esub
These channels are independent under the assumption of an identical and uncorrrelated \SM{check} noise in the detector arms. With constant delays in the rigid approximation, with the notation $z\equiv \exp[2i\pi fL]$ the TDI combinations take the form
\bsub\label{eq:aet}
\begin{align}
	\tilde{a} &= \left[ (1+z) \left( \tilde{y}_{31} + \tilde{y}_{13} \right) - \tilde{y}_{23} - z \tilde{y}_{32} - \tilde{y}_{21} - z \tilde{y}_{12} \right] \,,\\
	\tilde{e} &= \frac{1}{\sqrt{3}} \left[ (1-z)\left( \tilde{y}_{13} - \tilde{y}_{31} \right) + (2+z) \left( \tilde{y}_{12} - \tilde{y}_{32} \right) \right. \nn\\
	&\qquad\quad \left. + (1+2z) \left( \tilde{y}_{21} - \tilde{y}_{23} \right) \right] \,,\\
	\tilde{t} &= \frac{\sqrt{2}}{\sqrt{3}} \left[ \tilde{y}_{21} - \tilde{y}_{12} + \tilde{y}_{32} - \tilde{y}_{23} + \tilde{y}_{13} - \tilde{y}_{31} \right] \,,
\end{align}
\esub
where we have eliminated frequency-dependent prefactors that are common to the signal and to the noise by introducing the rescalings \SM{for $\tilde{a}$, $\tilde{e}$ is it $1/z^{2}$ ?}
\bsub\label{eq:scalingAET}
\begin{align}
	\tilde{a}, \tilde{e} &= \frac{1}{i \sqrt{2} z \sin (2\pi f L)}\times \tilde{A}, \tilde{E} \,,\\
	\tilde{t} &= \frac{1}{2\sqrt{2} z^{3} \sin (\pi f L) \sin (2\pi f L)} \times \tilde{T} \,.
\end{align}
\esub
We will use mode-by-mode transfer functions for these reduced channels as 
\be\label{eq:defTlmaet}
	\tilde{a}, \tilde{e}, \tilde{t} = \sum_{\ell, m} \calT_{a,e,t}^{\ell m} \tilde{h}_{\ell m}\,.
\ee
To make the connection between these observables and the familiar strain observed by ground-based intruments (see Sec.~\ref{} detailing the low-frequency approximation), we also introduce the notation
\be\label{eq:defhaet}
	\tilde{h}_{a,e,t} \equiv \frac{1}{-6i \pi f L} \times \tilde{a}, \tilde{e}, \tilde{t} \,,
\ee
and similarly the transfer functions $\calT_{h_{a}, h_{e}, h_{t}}^{\ell m} = \calT_{a,e,t}^{\ell m} / (-6 i \pi f L)$.

Scaling out the same square factors from the noise power spectral density as
\bsub
\begin{align}
	S_{n}^{A}, S_{n}^{E} &= 2 \sin^{2} (2\pi f L) \times S_{n}^{a}, S_{n}^{e} \,,\\
	S_{n}^{T} &= 8 \sin^{2} (\pi f L) \sin^{2} (2\pi f L) S_{n}^{t} \,,
\end{align}
\esub
the reduced PSD for the three channels take the form
\bsub\label{eq:Snaet}
\begin{align}
	S_{n}^{a} = S_{n}^{e} &= 2 \left( 3 + 2\cos (2\pi f L) + \cos (4 \pi f L) \right) S^{\rm pm}(f) \nn\\
	& \quad + \left( 2 + \cos (2\pi f L) \right) S^{\rm op}(f) \,,\\
	S_{n}^{t} &= 4 \sin^{2} (2\pi f L) S^{\rm pm}(f) + S^{\rm op}(f) \,,
\end{align}
\esub
with $S^{\rm pm}$ the test-mass noise PSD and $S^{\rm op}$ the optical noise PSD, described in~\ref{} \SM{complete}. Note that the confusion noise coming from the background of galactic binaries in the  LISA band is to be added to the point-mass and optical noises. We can define strain-like noise PSD associated to the strain-like TDI observables~\eqref{eq:defhaet} as
\be\label{eq:defShaet}
	S_{h}^{a,e,t} (f) = \frac{S_{n}^{a,e,t}(f)}{(6 \pi f L)^{2}}\,.
\ee

The prefactors~\eqref{eq:scalingAET} are oscillatory and have zero-crossings at high frequencies, with the first one occuring at $f_{L}/2 = 0.06 \mathrm{Hz}$, which is why it is convenient to eliminate them to avoid $0/0$ numerical instabilities. However, scaling these factors out from both the signal and the noise is an approximation, as we can expect that the real delays would lead to imperfect cancellations in the vicinity of the zero-crossings.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{The low-frequency limit}
\label{subsec:lowfresponse}

As is well known~\cite{Cutler97}, in the low-frequency limit (also called the long-wavelength approximation), the finite-length effects of the arms of LISA disappear, and the response of the detectors falls back to the one of two LIGO-type detectors set in motion, rotated from each other by $\pi/4$.

For $f \ll f_{L}$, we have $2\pi f L \ll 1$ and the kernel~\eqref{eq:Gslr} reduces to
\be\label{eq:Gslrlowf}
	G^{\ell m}_{slr} \simeq \frac{i \pi f L}{2} \exp\left[ 2 i \pi f k\cdot p_{0} \right] n_{l} \otimes n_{l} : P_{\ell m}\,.
\ee
For even lower frequencies, when $f \ll f_{R}$ as well, we have $2\pi f R \ll 1$ and the delay term is negligible: $\exp\left[ 2 i \pi f k\cdot p_{0} \right] \simeq 1$. It can be convenient to introduce the following notations for this delay phase:
\be\label{eq:defPhiR}
	\Phi_{R} \equiv 2 \pi f k\cdot p_{0} \,, \quad \Delta \Phi_{R} = \Phi_{R} - \Phi_{R}(t=t_{f}^{\rm peak}) \,.
\ee
The quantity $\Phi_{R}(\tf)$ is often the Doppler phase in the literature; it may appear to be large, but in the limit of short-lived signals it corresponds to the fixed delay between the time of arrival at the SSB and the time of arrival at the LISA constellation. Only the variations of the Doppler phase carry useful information about the sky position. The phase difference $\Delta \Phi_{R}$ subtracts this constant time delay contribution \SM{[complete for $t_{L}$]}, which is equivalent to parametrizing the signal using the time variable $t_{L}$ as defined in~\eqref{}.

For $2\pi f L \ll 1$, we have $z\simeq 1$, and the link reversal symmetry $\tilde{y}_{slr} \simeq \tilde{y}_{r-ls}$, so that~\eqref{eq:aet} becomes (dropping $l$ indices and symmetrizing $r,s$)
\bsub\label{eq:aetlowf}
\begin{align}
	\tilde{a} &\simeq 4\tilde{y}_{31} - 2 \tilde{y}_{23} - 2 \tilde{y}_{12} \,,\\
	\tilde{e} &\simeq 2\sqrt{3} \left[ \tilde{y}_{12}  - \tilde{y}_{23} \right] \,,\\
	\tilde{t} &\simeq 0 \,,
\end{align}
\esub
with the $T$-channel becoming negligible in this limit. Using~\eqref{eq:Gslrlowf}, we can write
\be\label{eq:aelowfmodes}
	\tilde{a}, \tilde{e} = \sum_{\ell, m>0} (-2i\pi f) \exp\left[ 2 i \pi f k\cdot p_{0} \right] \tilde{h}_{\ell m} D_{a,e} : P_{\ell m} \,,
\ee
where we introduced the detector tensors
\bsub\label{eq:DaDe}
\begin{align}
	D_{a} &= \frac{L}{2} \left( n_{1}\otimes n_{1} + n_{3} \otimes n_{3} - 2 n_{2} \otimes n_{2} \right) \,,\\
	D_{e} &= \frac{L\sqrt{3}}{2} \left( n_{1} \otimes n_{1} - n_{3} \otimes n_{3} \right) \,.
\end{align}
\esub
Here, we have made apparent factors $(-2i\pi f)$ corresponding to the Fourier-domain translation of a time derivative. Indeed, the observables $\Delta \nu / \nu$ used here are time derivatives of the laser phase more commonly used for ground-based detectors.

We can now map these two channels to two fictitious LIGO-type detectors as follows. For an orthogonal detector of the same setup as the ground-based LIGO and Virgo with armlength $L_{D}$, rotated by an angle $\epsilon_{D}$ from the basis vectors $x,y$, the detector tensor is
\begin{align}
	D &= \frac{L_{D}}{2} \left[ \cos 2\epsilon_{D} \left( x\otimes x - y\otimes y \right) \right. \nn\\
	& \qquad\quad + \left. \sin 2\epsilon_{D} \left( x\otimes y + y \otimes x\right) \right] \,.
\end{align}
By comparison with~\eqref{eq:DaDe}, using the LISA frame as detector frame (see App.~\ref{app:conventions}) we obtain
\be
	L_{a} = L_{e} = \frac{3L}{2} \,, \; \epsilon_{a} = \frac{2\pi}{3} \,, \; \epsilon_{e} = \frac{5\pi}{12} \,.
\ee
Note a degeneracy $\pm \pi$ in $\epsilon_{a,e}$, reflecting a freedom in the choice of the orientation of these effective detectors.

We can recover familiar pattern functions analogous to the ones of ground-based detectors (for $\psi_{L}=0$) by factoring out the effective length, defining
\be\label{eq:defFapcFepc}
	F_{a,e}^{+,\times} \equiv \frac{1}{3L} D_{a,e} : P_{+,\times}^{0} \,,
\ee
which gives in terms of the LISA-frame sky position angles $\lambdaL$, $\betaL$:
\bsub\label{eq:FapcFepc}
\begin{align}
	F_{a}^{+} &= \frac{1}{2} \left( 1 + \sin^{2}\beta_{L} \right) \cos \left(2\lambda_{L} - \frac{\pi}{3} \right) \,,\\
	F_{a}^{\times} &= \sin\beta_{L} \sin \left(2\lambda_{L} - \frac{\pi}{3} \right) \,,\\
	F_{e}^{+} &= \frac{1}{2} \left( 1 + \sin^{2}\beta_{L} \right) \cos \left(2\lambda_{L} + \frac{\pi}{6} \right) \,,\\
	F_{e}^{\times} &= \sin\beta_{L} \sin \left(2\lambda_{L} + \frac{\pi}{6} \right)  \,.
\end{align}
\esub
One can check that the expressions for the channel $e$ is obtained from the expressions for $a$ with the replacement $\lambdaL \rightarrow \lambdaL + \pi/4$.

If we introduce
\begin{align}\label{eq:Flmae}
	F_{a,e}^{\ell m} &= \frac{1}{2} \sYlm e^{-2 i \psi_{L}} \left( F_{a,e}^{+} + i F_{a,e}^{\times}\right) \nn\\
	& + \frac{1}{2} (-1)^{\ell} \sYlminusmstar e^{+2 i \psi_{L}} \left( F_{a,e}^{+} - i F_{a,e}^{\times} \right) \,,
\end{align}
the mode transfer functions~\eqref{eq:defTlmaet} become
\be\label{eq:transferlowfae}
	\tilde{a}, \tilde{e} = \sum_{\ell,m} \calT^{\ell m}_{a,e} \tilde{h}_{\ell m} = \left(-6 i \pi f L\right) \exp[2i \pi f k\cdot p_{0}] F_{a,e}^{\ell m} \tilde{h}_{\ell m}\,.
\ee
We see that scaling out $(-6 i \pi fL)$ as in~\eqref{eq:defhaet} brings us back to strain observables. The only difference with the response of a ground-based observatory is then the time dependency entering $p_{0}(t)$ and the LISA frame angles $\lambda_{L}(t)$, $\beta_{L}(t)$, $\psi_{L}(t)$ (see~\eqref{eq:Lframeangles}), with the time evaluated at $t_{f}^{\ell m}$.

Finally, we explain how to write a response fully analogous to ground-based detectors. Above we have chosen to write $\psi$ in a prefactor outside the pattern functions, but we could write $\psi$-dependent patter functions as
\bsub
\begin{align}
	F^{+}_{a,e}(\psi) &= \cos 2\psi F^{+}_{a,e} + \sin 2\psi F^{\times}_{a,e} \,,\\
	F^{\times}_{a,e}(\psi) &= -\sin 2\psi F^{+}_{a,e} + \cos 2\psi F^{\times}_{a,e} \,,
\end{align}
\esub
so that in the low-frequency approximation the response for the strain-like observables~\eqref{eq:defhaet} is
\be
	\tilde{h}_{a,e} = F^{+}_{a,e}(\psi) \tilde{h}_{+} + F^{\times}_{a,e}(\psi) \tilde{h}_{\times} \,,
\ee
if we ignore the delay $k \cdot p_{0}$ and treat the angles as constants.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Methodology}
\label{sec:method}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Bayesian setting}
\label{subsec:defbayes}

Introducing the standard matched-filter inner product (also called overlap) as
\be\label{eq:definnerproduct}
	( \tilde{a} | \tilde{b} ) = 4 \mathrm{Re} \int_{0}^{+\infty} df \; \frac{\tilde{a}(f) \tilde{b}^{*}(f)}{S_{n}(f)} \,,
\ee
for stationary Gaussian noise with noise PSD $S_{n}$, the likelihood $\calL = p(d | \bm{\theta})$ for a given gravitational wave channel takes the form
\be\label{eq:deflnL}
	\ln \calL = -\frac{1}{2} \left( h(\bm{\theta}) - d | h(\bm{\theta}) - d \right) \,,
\ee
with the data stream being a superposition of the gravitational wave signal for the true parameters $\bm{\theta}_{0}$ and the noise realization in the experiment, $d = h(\bm{\theta}_{0}) + n$. In general, the templates $h(\theta)$ used for the analysis will only be an approximation of the physical signals entering the data stream $d$; we will ignore entirely this distinction and neglect the systematic errors in the waveform model. The posterior distribution for the physical parameters $\bm{\theta}$ given the observed data $d$ is then
\be\label{eq:defBayes}
	p\left( \bm{\theta} | d \right) = \frac{p(d | \bm{\theta})p(\bm{\theta})}{p(d)}\,,
\ee
with $p(\bm{\theta})$ the priors on the parameters, and $p(d)$ the evidence that we will ignore here as it enters as a multiplicative constant in the posterior.

In our analysis, we will use the so-called zero-noise approximation. This corresponds simply to performing a Bayesian analysis with~\eqref{eq:deflnL} and ~\eqref{eq:defBayes}, but setting the noise realization to zero, $n=0$. It allows us to accelerate the likelihood computation, as will be explained in~\ref{}. For exploratory parameter estimation runs, this approximation allows us to explore the structure of the likelihood with its possible parameter degeneracies (\SM{cite past use of this approx.}), and is a significant improvement over Fisher matrix estimates in that sense. We leave the extension of our analysis to include noise realizations for future work. We will also ignore waveform systematic errors and assume our waveform templates match exactly the real signals.

\SM{complete} The likelihood function that we use, with a zero noise realization, is
\begin{align}\label{eq:deflnLaet}
	\ln\calL &= -\frac{1}{2} \left[ \left( \tilde{a} - \tilde{a}_{\rm inj} | \tilde{a} - \tilde{a}_{\rm inj}  \right) + \left( \tilde{e} - \tilde{e}_{\rm inj} | \tilde{e} - \tilde{e}_{\rm inj}  \right) \right. \nn\\
	& \qquad\qquad + \left. \left( \tilde{t} - \tilde{t}_{\rm inj} | \tilde{t} - \tilde{t}_{\rm inj} \right) \right] \,,
\end{align}
with the $\rm inj$ subscript indicating the injected signals, and where the inner products $(\cdot | \cdot)$ are given by~\eqref{eq:definnerproduct} with the noise PSDs~\eqref{eq:Snaet}.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Reduced order model for EOBNRv2HM waveforms.}
\label{subsec:ROM}

As opposed to previous studies of Bayesian parameter recovery for LISA, we wish to use full inspiral-merger-ringdown signals. Since higher harmonics will play a crucial role in our analysis, in this study we use the Effective-One-Body (EOB) waveform model \texttt{EOBNRv2HM}~\cite{Pan+11}. These waveforms are based on the EOB formalism~\cite{BD99, BD00}, and are calibrated on a set of numerical relativity waveforms. The model is limited to non-spinning systems on quasicircular orbits, but includes the most important higher harmonics in the signal:
\be
	(\ell, m) = (2,2) ,\, (2,1) ,\, (3,3) ,\, (4,4) ,\, (5,5) \,.
\ee
The waveforms are generated in the time domain by integrating a system of ODEs, an operation requiring up to seconds of computing time for long signals. For this reason, we developed a reduced order model (ROM) for these waveforms, \texttt{EOBNRv2HM}, following the methods of~\cite{Puerrer14}, enabling a much faster generation of the Fourier-domain amplitudes and phases of the modes~\eqref{eq:hlmampphase}.

We note that the assumption of non-spinning black holes is an important limitation to a realistic assessment of parameter uncertainties. In particular, it means that our results ignore the well-known degeneracy between mass ratio and spin \cite{Baird+2013}, thus underestimating the uncertainty in the recovered mass ratio. By ignoring misaligned spins, we also neglect the possible effects of orbital precession on parameter degeneracies. Nevertheless, consistently including merger, ringdown and higher harmonics already represents a significant improvement over previous studies. We also expect intrinsic and extrinsic parameters to correlate weakly, at least in the absence of precession, so that the conclusions drawn from Sec.~\ref{sec:SMBHPE} below, notably the analysis of possible degeneracies in the extrinsic part of the likelihood, should hold for aligned spin systems. \TDC{the last sentence would fit well in the conclusion.}

Fast waveforms including both the aligned components of the spins and higher harmonics are becoming available in the phenomenological waveform family~\cite{London+17}, as EOB models~\cite{Cotesta+18}, and as Numerical Relativity surrogates~\cite{Varma+18}.
ROMs to accelerate the waveform model of~\cite{Cotesta+18} are under construction, and we plan to include the effects of aligned and misaligned spins in future studies.
\TDC{this paragraph also sounds like conclusion material.}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Likelihood computation with zero noise}
\label{sec:likelihood}

Setting the noise realization to zero in~\eqref{eq:deflnL}, having at our disposal a compact amplitude/phase respresentation of the signals allows us to compute likelihoods in an accelerated fashion. In general, both the template and the injection in~\eqref{eq:deflnL} are given as frequency series sampled with the Nyquist criterion $\Delta f = 1/(2T)$ with $T$ the duration of the signal, and the overlaps~\eqref{eq:definnerproduct} are simply computed as discrete sums over those frequency samples. Although transforming~\eqref{eq:definnerproduct} in a discrete is a simple operation, the size of the frequency series alone can represent a significant cost. In the context of binary neutron star observations. In the LISA. \SM{complete} \TDC{this paragraph seems to need more work. I would start with the existing general case, then say that by using a zero-noise realization we can write the amplitude/phase representation and use a sparse grid and get a large speedup.}

Applying the response as in~\ref{subsec:response} mode-by-mode on the sparsely sampled amplitude and phase generated as in~\ref{subsec:ROM}, we obtain a complete representation of both the waveform and of the instrument transfer functions~\eqref{} on a few hundred points in the Fourier domain, with the full signal being implicitly reconstructed with a standard cubic spline interpolation over frequencies. Decomposing~\eqref{eq:deflnL} as
\be\label{eq:lnLoverlapstructure}
	\ln \calL = \left( h(\bm{\theta}) | h(\bm{\theta}_{0}) \right)- \frac{1}{2} \left( h(\bm{\theta}) | h(\bm{\theta}) \right) - \frac{1}{2} \left( h(\bm{\theta}_{0}) | h(\bm{\theta}_{0}) \right) \,,
\ee
we have to compute inner products of the form~\eqref{eq:definnerproduct}. Note that individual terms in~\eqref{eq:lnLoverlapstructure} can be individually large, and computing $\ln \calL$ relies on accurate cancellations. Decomposing further in TDI channels as in~\eqref{} and in harmonics as in~\eqref{}, we have a sum of terms with the structure (symbolically) \TDC{we need one or two more equations describing explicitly how to go from $\tilde{y}_{slr}$ to $\ln \calL$}
\be
	\sum_{\ell m, \ell'm'}\int \frac{df}{S_{n}} \; \calT_{1}^{\ell m} \calT_{2}^{\ell' m'} A_{1,\ell, m} A_{2, \ell' m'} e^{i(\Phi_{1,\ell m} - \Phi_{2,\ell' m'})} \,,
\ee
with transfer functions $\calT$, amplitudes $A$, and phases $\Phi$. \TDC{should this notation be aligned to Eq 6 and 7?}
The difficulty of computing numerically such an overlap depends on the phase difference. A large phase difference causes the integrand to be very oscillatory, requiring more frequency resolution than non-oscillatory integrands; on the other hand, oscillatory integrands give raise to a small integral due to cancellation effects, while non-oscillatory integrands contribute the most. For a single mode, SNR terms of the type $(h|h)$ have a zero phase difference by construction, but including different modes generates cross-terms $(\ell, m) \neq (\ell', m')$ with a large phase difference. In a Bayesian analysis, a large fraction of the time (after burn-in) will be spent exploring signals that are rather close to the injection.

Thus, one can envision several approaches to compute integrals of the type~\eqref{eq:lnLoverlapstructure}, such as factoring out a guess of the injected signal~\cite{} and ignoring cross-terms between modes. In this work, we use a generic numerical treatment for the integrals~\eqref{eq:lnLoverlapstructure} and keep all terms with no further approximation.

First, we built a joint sparse frequency grid suitable to represent both signals and the transfer functions. We then resample the integrand on this grid, separating prefactors (noise PSD, transfer function without the Doppler phase~\eqref{eq:defPhiR}, signal amplitude) from phases (Doppler phases, signal phase difference). We build a cubic spline for the prefactor, and a quadratic spline for the phase. We obtain the structure
\be\label{eq:fastlikestructure}
	\sum_{j \in \mathrm{grid}} \int_{f_{j}}^{f_{j+1}} df \; P_{j} (f) e^{i \phi_{j} (f)} \,,
\ee
where in each grid interval $P_{j}$ is a cubic polynomial and $\phi_{j}$ a quadratic polynomial. We can then compute the elementary integrals~\eqref{eq:fastlikestructure} using a combination of integrations by parts and asymptotic expansions, as explained in App.~\ref{app:numintegration}. The number of grid intervals is typically several hundreds \SM{to be completed, report speed}.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Bayesian sampling}
\label{sec:samplers}

For this exploratory work we take a ``naive'' \TDC{``brute force''?} approach to inferring the posterior probability distribution of the parameters, without applying specific knowledge or expectations about distributions and degeneracies. Such assumptions might in fact lead to an incomplete exploration of the posterior probability in ways that would be difficult to recognize and diagnose. In order to demonstrate that the problem is tractable without critically depending on the details of the methodology, we also use two independent approaches to sample the posterior distributions: parallel tempering Markov-chain Monte Carlo (MCMC) and nested sampling.

Our MCMC code \texttt{PTMCMC}\footnote{https://github.com/JohnGBaker/ptmcmc} has been developed through several astrophysics projects, tested on several sampling problems, and modularly designed with the aim of minizing opportunities for errors with new applications. The code performs parallel tempered MCMC \cite{Swendsen+1986,Littenberg2009} with temperatures slowly adjusted to achieve nearly equal exchange rates among all pairs of adjacent temperatures.  Most runs here performed comparably with either 80 or 240 parallel temperature chains.
We applied a general-purpose proposal distribution composed of a weighted set of sub-proposals, including differential-evolution steps~\cite{Vrugt+2008} (although the proposal in this case is based on each single chain, not an ensemble) and a collection of several Gaussian step draws of varying sizes scaled off the prior domain at about 0.01--1\% of its scale and weighted favor the smaller scale proposal draws.
Effective sample sizes (ESS) were estimated from the number of post-burn-in samples, reduced by the autocorrelation length, with the burn-in size chosen to optimize \TDC{maximize?} the ESS. In most cases, the runs were continued until achieving an estimated ESS~$>2000$.

For comparison and verification we also computed posterior samples using the nested sampling code \texttt{BAMBI} \cite{Graff+2012}, a variant of \texttt{MultiNest} \cite{Feroz+2009b} with additional options (unused here).  The nested sampling algorithm evolves a set of 'live points' toward regions of high probability by iteratively resampling the lowest probability point from within an ever-narrowing region covering the set of live-point samples.  The computation proceeds until the estimated Bayesian evidence, or marginal probability, within the region covered by the live points is smaller than some threshold.  Posterior-distributed samples are then drawn based on the set of sub-regions and sample posterior values thereby generated. In our runs we used 4000 live points and a stopping evidence threshold of 1.0. \JGB{Sylvain needs to check these values.}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Fisher matrix parameter estimation}
\label{sec:Fisher}

For comparison with our Bayesian inference results we also compute estimates of parameter uncertainties using the Fisher information matrix, which despite its limitations is the common workhorse of LISA science studies to date ~\cite{Vallisneri08}. For measurements with additive Gaussian noise, as assumed here, the Fisher information matrix can be computed by
\be
F_{ij}=\left( \partial_{\theta_i} h| \partial_{\theta_i} h \right).
\ee
The inverse of this matrix estimates the covariance matrix describing parameter uncertainty.
The derivatives are computed by second-order finite differences, with the signal inner-products expanded and computed before differencing. For these calculations, where numerical smoothness is more of a concern than speed we compute the inner products explicitly on a fine grid.

Generally, finite difference Fisher matrices can be problematic, with small numerical defects potentially having outsized impact, so the finite-difference step size $\epsilon_i$ used in each parameter derivative $\partial_{\theta_i}h$ must be chosen carefully. We target the step-size to be scaled off the diagonal Fisher matrix elements by ${\epsilon_i}\approx\delta/\sqrt{F_{ii}}$ using $\delta=0.001$ \JGB{This is \texttt{fisher\_err\_target}, was it different for some runs?}  for the results shown here.  To achieve this we set begin with an initial choice of the $\epsilon_i$ scaled of parameter values or prior widths, then we estimate the Fisher diagonals and iterate until convergence. In this process we also constrain that the step is never more than $10^{-10}$ times the initial scaling. \JGB{There are some more special-case details, but probably not worth elaborating.  We could also discuss how we do matrix inversion, but I don't think there is anything interesting there.}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Massive black holes signals}
\label{sec:SMBH}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Signals and transfer functions}
\label{sec:signaltransfer}

We focus our analysis on a single set of mass parameters, representative of canonical MBHB sources expected for LISA~\cite{Proposal}: we pick a total redshifted mass $M=m_{1}+m_{2} = 2\times10^{6} M_{\odot}$ and a mass ratio $q=m_{1}/m_{2} = 3$, and place the source at a redshift $z=4$. The inclination plays an important role in deciding the importance of higher harmonics; we set it to the median value $\iota = \pi/3$. We will study in detail two such systems, named cases I and II, stemming from a series of twelve runs with randomized orientation parameters, and chosen to exemplify qualitative differences in the parameter estimation. The parameters are summarized in Table~\ref{tab:MBHBparams}, along with the SNR of these signals with and without higher harmonics. The different randomized orientations and the inclusion of higher harmonics both have a sizeable impact on the SNR.

We note that, by contrast with current ground-based observations that are horizon-limited and that have a strong selection bias towards systems with favorable orientations (face-on or face-off), the LISA horizon for MBHB systems extends to essentially the entirety of the observable universe; it is therefore natural to consider randomized orientations.

\begin{table}\label{tab:MBHBparams}
	\begin{tabular}{|c||c|c|}
		\hline
		Identifier 		& I 	& II   \\
		\hline
		\hline
		Mass 1 ($\Msol$) 	& \multicolumn{2}{|c|}{$1.5\times10^{6}$} \\
		\hline
		Mass 2 ($\Msol$) 	&  \multicolumn{2}{|c|}{$0.5\times10^{6}$}\\
		\hline
		Redshift 		&  \multicolumn{2}{|c|}{$4.$}  \\
		\hline
		Lum. Distance (Mpc) 		&  \multicolumn{2}{|c|}{$36594.3$} \\
		\hline
		Inclination (rad) 		& \multicolumn{2}{|c|}{$\pi/3$}  \\
		\hline
		Phase (rad) 			& $2.140$	& $-1.249$ \\
		\hline
		Ecliptic longitude (rad) 			& $3.335$	& $2.275$ \\
		\hline
		Ecliptic latitude (rad) 			& $1.468$	& $-1.376$ \\
		\hline
		Polarization (rad) 			& $2.237$	& $1.635$ \\
		\hline
		\hline
		LISA SNR $h_{22}$			& 857.4 & 645.7 \\
		\hline
		LISA SNR $h_{\ell m}$			& 944.8 & 666.0 \\
		\hline
	\end{tabular}
	\caption{Parameters of the simulated MBHB mergers. \TDC{Maybe we can show
			 these on the upper right of each corner plot instead.}}
\end{table} 

\begin{figure}
  \centering
  \includegraphics[width=.99\linewidth]{../plots/plot_hc_tdia_hm.pdf}
  \caption{.}
  \label{fig:hctdiahm}
\end{figure}

\begin{figure*}
  \centering
  \includegraphics[width=.98\linewidth]{../plots/plot_smbh9_tdi.pdf}
  \caption{\SM{TODO: rethink the visualization, maybe plot only transfer functions and Doppler phase}.}
  \label{fig:tranferSMBHCase9}
\end{figure*}

We illustrate the Fourier-domain signal in Fig.~\ref{hctdiahm}, with its higher harmonics, by showing mode-by-mode contributions to the characteristic strain, as well as the characteristic noise PSD, defined to be
\bsub
\begin{align}
	\tilde{h}_{a,e,t}^{c} (f) &= 2 f \tilde{h}_{a,e,t} (f) \,,\\
	S^{a,e,t}_{c} (f) &= f S^{a,e,t}_{h} (f) \,,
\end{align}
\esub
with the strain-like observables and noise PSD are defind in~\eqref{eq:defhaet} and~\eqref{eq:defShaet}. We represent the $A$ TDI channel (the $E$ channel being similar, and the $T$ channel negligible at low frequencies). This characteristic strain and associated PSD are often used for plotting~\cite{}, since one can visualize the $\SNR$ by integrating by eye under the curve with a logarithmic $x$-axis. The full signal shows oscillatory features in frequency that are due to beatings between the harmonics that have smooth amplitudes individually. 

We also highlight in Fig.~\ref{fig:hctdiahm} different time intervals before the merger (see the next Section~\ref{subsec:MBHBacctime}). These times correspond each to a different frequency across modes, by virtue of the approximate relation between instantaneous mode frequencies in the inspiral:
\be\label{eq:fscalinglm}
	f_{\ell m}(t) \simeq \frac{m}{2} \times f_{22}(t) \quad (\mathrm{Inspiral})\,.
\ee
We also highlight the frequency at merger, also denoted peak frequency. Since we represent mode contributions to the TDI observables, the response is included in this Figure; we see that all modes display structure at low frequencies that corresponds to the time modulation resulting of the LISA motion.

Fig.~\ref{fig:tranferSMBHCase9} shows the detail of the transfer functions themselves. The Doppler phase variation $\Delta \Phi_{R}$ is a small effect at low frequencies, being suppressed by a factor $\sim 2\pi f R$; it is also small at higher frequencies, because the chirp happens over a short time interval during which $\Phi_{R}$ does not have time to vary. We also show transfer functions for the mode $h_{22}$ in the three TDI channels $A,E,T$, ($T$ is suppressed at low frequencies), after factoring out the Doppler phase. The low-frequency features show the time-dependency of the response created by the LISA motion, while frequency-dependency in the response appears at high frequencies. We will decompose further these different physical effects below in Sec.~\ref{subsec:MBHBresponseapprox}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Accumulation of signal with time}
\label{subsec:MBHBacctime}

\begin{figure*}
  \centering
  \includegraphics[width=.98\linewidth]{../plots/overlapmodebymode_maxfscaledlm_t.pdf}
  \caption{.}
  \label{fig:modeoverlapsoftime}
\end{figure*}

We now illustrate the accumulation of the gravitational wave signal with time, which is crucial to understand the ability of the instrument to indentify and localize MBHB signals in advance of their coalescence, as well as the requirements put on the instrumental configuration (data gaps and downlink cadence). As will be shown in more details in a separate publication~\cite{}, within the uncertainties of astrophysical models we can expect the bulk of MBHB signals to be detectable only a few days prior to merger, while a tail of more favorable events could be observable for significantly longer times, up to months.

We will focus on the system II of Table~\ref{tab:MBHBparams}, and we will highlight four different epochs, corresponding to the time before merger where a certain fraction of the total $\SNR = 666$ has been accumulated. We include higher harmonics here. These epochs are:
\begin{itemize}
	\item $\SNR/64$: $\sim 42\mathrm{h}$ before merger, which corresponds roughly, with $\SNR \simeq 10$, to the first time we could confidently claim a detection;
	\item $\SNR/16$: $\sim 2.5\mathrm{h}$ before merger;
	\item $\SNR/4$: $\sim 7\mathrm{min}$ before merger.
\end{itemize}

To represent the observations stopping with a certain time to merger left, we will approximate the cut in time using simply the time-to-frequency correspondence~\eqref{eq:deftflm} to translate it as a cut in frequency. In a more realistic setting, an abrupt interruption of the signal would translate into non-local features in the Fourier domain unless tapering is applied, but we ignore these complications here.

The time-to-frequency correspondence~\eqref{eq:deftflm} gives for each mode time as a function of frequency. It is accurate for the inspiral, as such a correspondence is at the heart of the SPA \SM{check SPA defined}. As a function it also extends formally through merger, while losing in accuracy and in physical interpretation, becoming non-monotonous with frequency (see the discussion in~\cite{MB18}). Due to the scaling $h_{\ell m} \propto e^{-i m \phi_{\rm orb}}$ with $\phi_{\rm orb}$ the orbital phase, a given time corresponds to different frequencies $f_{\ell m}(t) \simeq m/2 \times f_{22}(t)$ \SM{update with previous section} for different modes during the inspiral. At merger and this relation will be lost and the non-monotonicity of $\tf$ makes it impossible to invert $\tf$ to build $f(t)$. Equivalently,
\be\label{eq:relationtflm}
	t_{f}^{\ell m} \left( \frac{m}{2} f\right) \simeq t_{f}^{22} (f) \quad (\mathrm{Inspiral}) \,.
\ee
This relation is illustrated in Fig.~\ref{}. We see that it holds almost up to merger \SM{complete}, while different modes start to depart after this point.

Fig.~\ref{fig:modeoverlapsoftime} shows the accumulated contributions to the total SNR of individual mode combinations. For a generic signal $s = \sum_{\ell m} s_{\ell m}$ with mode contributions $s_{\ell m}$ ($s$ is any among the channels $\tilde{a}$, $\tilde{e}$, $\tilde{t}$)
\be
	\SNR^{2} = (s|s) = \sum_{\ell m} \sum_{\ell' m'} (s_{\ell m} | s_{\ell' m'}) \,.
\ee
We choose to show contributions to $\SNR^{2}$ because this is the scale on which the contributions of different modes and channels are additive, and because it is the relevant scale for the log-likelihood~\eqref{eq:deflnL}, since $\ln \calL \sim \SNR^{2}$. We also sum over the three channels ($T$ being essentially negligible). Together with the total contribution to $\SNR^{2}$, the three panels of Fig.~\ref{fig:modeoverlapsoftime} show diagonal terms $(s_{\ell m} | s_{\ell m})$, cross-terms involving the dominant quadrupolar mode $(s_{22} | s_{\ell m})$, and finally other cross-terms between subdominant modes. Results are displayed as a function of the time to merger, and we show separately the result obtained for the full post-merger signal.

We can draw several conclusions from Fig.~\ref{fig:modeoverlapsoftime}. The signal reaches detectability at $\SNR=10$ about two days before merger. We see that the SNR accumulates rapidly in the last instants before merger, as shown in particular by reaching $\SNR/4$ only 7 minutes before coalescence. Stopping the signal at a given time in the inspiral changes somewhat the hierarchy between subdominant modes: contrasting Fig.~\ref{fig:modeoverlapsoftime} with Fig.~\ref{fig:hctdiahm}, we see e.g that $h_{21}$ is now subdominant before merger (and increases significantly in strength when including the post-merger signal). This is because modes $h_{\ell m}$ with a higher $m$ will reach a higher frequency at any given time, while the weighting by the noise favors higher frequencies. This is also visible in Fig.~\ref{fig:hctdiahm} where ticks translate a cut in time into a different cut in frequency for different modes.

We also see that, as even the most subdominant modes contribute significantly to $\SNR^{2}$, our set $(22, 21, 33, 44, 55)$ is incomplete; we will need waveforms with a richer set of higher harmonics to analyze real LISA data. Diagonal terms $(s_{\ell m} | s_{\ell m})$ and cross terms with $(\ell m) \neq (\ell' m')$ are qualitatively different. Diagonal terms accumulate coherently, while cross terms are oscillatory, as they feature two modes with different phasings. This oscillatory character tends to suppress the contribution of the cross terms; however, we see they are not negligible, in particular the ones involving the dominant harmonic and a subdominant harmonic. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Decomposing the instrument response}
\label{subsec:MBHBresponseapprox}

\begin{figure}
  \centering
  \includegraphics[width=.98\linewidth]{../plots/responseapprox_tdia_22.pdf}
  \caption{Response approximations.}
  \label{fig:responseapproxtdia22}
\end{figure}

The LISA instrument response, as recalled in Section~\ref{sec:response}, features both time- and frequency-dependency. As we will see, these features play an important role in breaking degeneracies in the parameter estimation of the source, notably allowing us to localize the source in the sky. It is therefore important to understand these features, also in the light of the pre-merger accumulation of signal with time.

The time-dependency in the response mirrors the motion of the LISA constellation. In the low-frequency picture of~Sec.~\ref{subsec:lowfresponse}, the time dependency enters both in the Doppler phase term~\eqref{} (LISA moves in the wavefront) and in the time-dependent LISA-frame angles~\eqref{} (the LISA arms change orientation). However, we have seen in the previous section that the SMBH signals we consider here are quite short (less than two days). This limits the effect of the LISA motion: between the time where the signal becomes detectable and the merger, LISA has barely changed in orientation and position. Moreover, the region where the signal accumulates most of its SNR is even shorter, as shown in Fig.~{}.

To this end, we distinguish four different versions of the response:
\begin{enumerate}[(i)]
	\item \textit{Full}: in this case, we keep the full response of Secs.~\ref{subsec:FDresponse}-\ref{subsec:TDIresponse}, with its complete time and frequency dependency;
	\item \textit{Frozen}: we neglect the LISA motion by evaluating all time-dependent vectors at $\tf = t_{f}^{\rm peak}$, effectively freezing LISA in its orbit, while keeping the frequency dependency in the response;
	\item \textit{Low-$f$}: we implement the low-frequency (long-wavelength) approximation as in Sec.~\ref{subsec:lowfresponse}, while still keeping the time-dependency due to the motion;
	\item \textit{Frozen low-$f$}: we neglect both the time and frequency dependency in the response.
\end{enumerate}

Case (iii), \textit{Low-$f$}, has been extensively used in the past for the analysis of MBHB signals. In particular, this simplification has been used in previous MLDC studies. Being based on the $f \ll f_{L}$ approximation, it is less inaccurate for inspiral-only signals, to which most previous studies were limited, as it is for a full IMR signal.

In the case (iv), \textit{Frozen low-$f$}, the response is equivalent to two LIGO-type detectors, lying motionless in the same location and rotated from each other by $\pi/4$, and there is no other information on the source's sky position other than the pattern functions of the two effective detectors. Contrarily to networks of ground-based observatories, we have no triangulation information from times of arrival at different detectors. This case is the most degenerate, and will be useful to get an anlytical understanding of approximate degeneracies occuring when using the more complicated full response (i). 

The effect on the response of adopting these approximations is shown in Fig.~\ref{fig:responseapproxtdia22}. We display the strain transfer function $\calT_{h_{a}}^{22}(f)$ as defined in~\eqref{eq:defhaet} for the mode $h_{22}$, with the four lines showing the four approximations (i)-(iv). Vertical lines also indicate the times to merger highlighted in Sec.~\ref{subsec:MBHBacctime}, as well as the peak frequency. Paralleling this figure to Figs.~\ref{fig:hctdiahm} and~\ref{fig:modeoverlapsoftime}, we stress that most of the SNR is accumulated in the very last instants before merger and at the merger itself, due to the noise normalization not visible at the level of the transfer function.

The \textit{Frozen low-$f$} transfer function is just a constant factor, similarly to the LIGO response where $h_{+,\times}$ are simply multiplied by pattern functions. The \textit{Low-$f$} transfer function goes to the same constant at high frequencies, where the signal chirps so rapidly that the LISA motion is negligible. At low frequencies, however, modulations due to the LISA motion appear. The \textit{Frozen} transfer function asymptotes to the constant of the \textit{Frozen low-$f$} case at low frequencies, for $f \ll f_{L}$. At higher frequencies, we see a growing departure from this approximation. As noted in Sec.~\ref{subsec:lowfresponse}, when reaching the armlength transfer frequency $f_{L} = 0.12 \Hz$ the long-wavelength approximation has completely broken down; departures start to be significant at much lower frequencies. Finally, the \textit{Full} transfer function displays all the features we discussed.

We note finally a coincidence in Fig.~\ref{fig:responseapproxtdia22}: the frequency below which we see the imprint of the LISA motion and the frequency above which we see the breakdown of the long-wavelength approximation appear to be the same. This will not be true in general: the former is essentially a measure of the time-to-frequency correspondence $\tf$, with lower-mass signals having support and showing these features at higher frequencies, while the latter only marks the magnitude of $2\pi f L$ factors and is source-independent\footnote{The effect in the transfer functions is source-independent; however, the SNR accumulation with frequency is source-dependent and will influence the impact of these features on the parameter estimation.}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Massive black holes parameter estimation}
\label{sec:SMBHPE}

\subsection{Analysis of IMR signals}
\label{subsec:SMBHPEfull}

\begin{figure*}
  \centering
  \includegraphics[width=.98\linewidth]{../plots/corner_smbh_case0_ptmcmc_22_hm.png}
  \caption{.}
  \label{fig:PEsmbh22hmCase0}
\end{figure*}

\begin{figure*}
  \centering
  \includegraphics[width=.98\linewidth]{../plots/corner_smbh_case9_ptmcmc_22_hm.png}
  \caption{.}
  \label{fig:PEsmbh22hmCase9}
\end{figure*}

We performed Bayesian parameter estimation for the two MBHB sources listed in Table.~\ref{tab:MBHBparams}, using the methodology summarized in Sec.~\ref{sec:method}. In particular, we set the noise realization to zero, used accelerated likelihood based on an amplitude and phase representation of the signals. The priors used are logarithmic in mass, flat in luminosity distance, and flat for the angles: flat on the sphere for the pairs of angles $(\iota, \varphi)$ and $(\lambda, \beta)$, and flat for the polarization $\psi$. We expect priors to be unimportant for the masses, since they are well determined in this very high SNR limit. The luminosity distance, as we will see, can be less well determined in the absence of higher harmonics, and one should keep in mind that the prior choice does affect the posterior there.

To illustrate the role of higher harmonics in the analysis, we will present two classes of results: ``22'', where we inject and recover signals including only the dominant harmonic $h_{22}$, and ``HM'', where we both inject and recover with the higher harmonics $(h_{22}, h_{21}, h_{33}, h_{44}, h_{55})$. We do not attempt to recover an injection with higher modes using 22-mode waveforms; one expects parameter biases in this case, induced by the inadequacy of the simplified waveforms. A related question would be to assess the mode content necessary for waveform models to mitigate systematic biases when analyzing full GR signals. We leave such waveform systematics studies for future work; we only note that, as shown in Fig.~\ref{fig:modeoverlapsoftime}, the set of five modes we include in the present study is quite obviously incomplete.

Figs.~\ref{fig:PEsmbh22hmCase0} and~\ref{fig:PEsmbh22hmCase9} show posterior distributions for all parameters for Cases I and II respectively. We overlay ``22'' and ``HM'' posteriors. All results for MBHB systems are presented using LISA-frame parameters, as defined in App.~\ref{app:conventions}. We should keep in mind the difference in SNR of Cases I and II ($\SNR \simeq 945$ versus $\SNR \simeq 666$ with higher harmonics, see Table~\ref{tab:MBHBparams}), resulting from their different orientation, however their posteriors have qualitative differences that go beyond a simple scaling of the errors as $\sim 1/\SNR$ \SM{redundant ?}.

In Case I, the ``22'' posterior appears to be well represented by a multimodal Gaussian, with multimodality for the angular parameters. The sky position, most notably, admits a degenerate mode at $\betaL \rightarrow -\betaL$, although it has less weight than the main mode around the injection. By contrast, in Case II, the ``22'' posterior is much more degenerate. The distance and inclination are very degenerate with each other, with a support extending all the way to $\iota=0$ (or $\iota=\pi$). The phase $\varphi$ and polarization $\psiL$ have a distinct extended degeneracy along lines of constant $\varphi + \psiL$ and $\varphi - \psiL$. Most notably, the sky position, if retaining the same overall bimodality $\betaL \rightarrow -\betaL$ as in Case I, shows here a curious feature: the marginalized sky posterior peaks away from the injected value. Looking at other panels, we see that the shifted peak corresponds to the region of high distance (and extremal inclination). This is a genuine featuer of the multidimensional zero-noise posterior and will be explained in Sec.~\ref{subsec:MBHBPEdegen22}.

In both Cases I and II, including the higher harmonics has a major effect on the parameter recovery, much beyond what we would expect from the sole gain in total SNR shown in Table.~\ref{tab:MBHBparams} (and a scaling of statistical errors $\sim 1/\SNR$). The marginalized posterior of the masses is narrower, although not qualitatively different; the major change is in the extrinsic parameters.

We can understand the effect of the higher harmonics by noting that, in a signal of the form $\sum_{\ell m} \sYlm(\iota, \varphi)$, measuring independently two separate contributions $(\ell m) \neq (\ell' m')$ gives us an independent measurement of the inclination $\iota$ by the relative amplitude of the two mode contributions 

First, including the higher harmonics in the analysis breaks the degeneracy between distance and inclination, an effect that is well known in the context of ground-based observations.

Second, the phase $\varphi$ also becomes independently measured.

\SM{Add sky area numbers ? Add table of $\pm 1\sigma$ intervals ?}

\SM{Add comparison between the two samplers + Fisher: Cases I \& II, 22 \& hm ($\times 4$), m1-m2, D-iota, lambda-beta}

\SM{Performance: waveform and likelihood costs, number of sampler evaluations}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Degeneracies in the sky}
\label{subsec:MBHBPEdegen}

The most remarkable feature in Figs.~\ref{fig:PEsmbh22hmCase0} and~\ref{fig:PEsmbh22hmCase9} is the existence of a degenerate mode (or secondary maximum) in the posterior distribution for the sky position $(\lambda_{L}, \beta_{L})$, located at $\beta_{L}^{*} = -\beta_{L}^{\rm inj}$, i.e. by reflecting the wave vector $k$ across the plane of the LISA constellation. This secondary mode has less weight than the main mode around the injection, but is present in both cases. In particular, it survives when including higher harmonics.

We can gain insight about degeneracies in the parameter space by considering the simple expressions representing the instrument response in the \textit{Frozen low-$f$} approximation described in Sec.~\ref{subsec:responseapprox}, appropriate for the low-frequency limit and signals short enough that the LISA motion can be neglected; we will explore in details the respective influence of these neglected effects in Sec.~\ref{sec:MBHBPEacctime}.

The \textit{Frozen low-$f$} response is given by~\eqref{eq:FapcFepc}-\eqref{eq:transferlowfae}, ignoring the $k\cdot p_{0}$ delay as a mere constant delay, and neglecting time-dependency in the LISA frame angles $(\lambda_{L}, \beta_{L}, \psi_{L})$. The response is then summarized by the pattern functions for harmonics $F^{\ell m}_{a,e} (\iota, \varphi, \lambda_{L}, \beta_{L}, \psi_{L})$ given in~\eqref{eq:Flmae}, which we reproduce here:
\begin{align}\label{eq:Flmaerepeat}
	F_{a,e}^{\ell m} &= \frac{1}{2} \sYlm (\iota, \varphi) e^{-2 i \psi_{L}} \left( F_{a,e}^{+} + i F_{a,e}^{\times}\right) (\lambda_{L}, \beta_{L}) \nn\\
	& + \frac{1}{2} (-1)^{\ell} \sYlminusmstar (\iota, \varphi) e^{+2 i \psi_{L}} \left( F_{a,e}^{+} - i F_{a,e}^{\times} \right) (\lambda_{L}, \beta_{L}) \,.
\end{align}

Changing the sign of $\beta_{L}$ in the pattern functions $F_{a,e}^{+,\times}$ given in~\eqref{eq:FapcFepc} changes the sign of $F_{a,e}^{\times}$ for both channels, leaving $F_{a,e}^{+}$ invariant. In~\eqref{eq:Flmaerepeat} the $F_{a,e}^{+,\times}$ factors of the two lines are exchanged. Since spin-weighted spherical harmonics~\cite{} obey the relation
\be
	\sYlm (\pi - \iota, \varphi) = (-1)^{\ell} \sYlminusmstar (\iota, \varphi) \,,
\ee
we see that changing $\iota \rightarrow \pi-\iota$, $\psi_{L} \rightarrow \pi - \psi_{L}$ leaves $F_{a}^{\ell m}$, $F_{e}^{\ell m}$ invariant.

This defines a transformation of extrinsic parameters yielding an exact degeneracy in the \textit{Frozen low-$f$} approximation, which we call the \textit{reflected} sky position (for a reflection with respect to the LISA plane):
\begin{align} \label{eq:degenreflection}
	\lambdaL^{*} &= \lambdaL \,, \nn \\
	\betaL^{*} &= -\betaL \,, \nn \\
	\psiL^{*} &= \pi - \psiL \,, \nn \\
	\iota^{*} &= \pi - \iota \,, \nn \\
	\varphi^{*} &= \varphi \,,
\end{align}
where we chose the transformation for $\psiL$ to keep this parameter in the range $[0, \pi]$.

From the structure of~\eqref{eq:Flmaerepeat}, other points in parameter space are degenerate in the low-frequency limit. First, $\lambdaL \rightarrow \lambdaL + \pi$ leaves the pattern functions $F_{a,e}^{+,\times}$ invariant. For $\lambdaL \rightarrow \lambdaL \pm \pi/2$, these pattern functions acquire an overall minus sign. Such an overall minus sign is readily compensated by a shift $\psiL \rightarrow \psiL \pm \pi/2$, so that we have the other transformation
\begin{align} \label{eq:degenlambdapi2}
	\lambdaL^{(k)} &= \lambdaL + \frac{k \pi}{2} \mod 2\pi \,, \, k = 0, \dots, 3 \,, \nn \\
	\psiL^{(k)} &= \psiL + \frac{k \pi}{2} \mod \pi \,, \, k = 0, \dots, 3 \,.
\end{align}

Combining~\eqref{eq:degenreflection} and~\eqref{eq:degenlambdapi2}, we arrive at eight different degenerate positions in the sky, equally spaced in $\lambdaL$ and symmetric above and below the LISA plane, with an inclination $\pi - \iota$ for the reflected positions and various values for the polarization $\psiL$. Among these eight secondary modes in the sky, two play special roles: first, the \textit{reflected} mode~\eqref{eq:degenreflection} already mentioned; and second, the \textit{antipodal} mode with
\begin{align} \label{eq:degenantipodal}
	\lambdaL^{(a)} &= \lambdaL + \pi \,, \nn \\
	\betaL^{(a)} &= -\betaL \,, \nn \\
	\psiL^{(a)} &= \pi - \psiL \,, \nn \\
	\iota^{(a)} &= \pi - \iota \,, \nn \\
	\varphi^{(a)} &= \varphi \,.
\end{align}

Importantly, when moving away from the \textit{Frozen low-$f$} approximation, taking into account the frequency-dependence in the \textit{Frozen} response, the \textit{reflected} is the only mode remaining degenerate. Indeed, as noted in Sec.~\ref{subsec:FDresponse}, in~\eqref{eq:Gslr} the frequency-dependent terms feature $k\cdot n_{l}$, $k \cdot p_{s,r}$ projections, that depend only on the projection of the wave vector $k$ in the plane of LISA, invariant for $\betaL \rightarrow -\betaL$. The LISA motion, however, will break the degeneracy.

When taking into account the LISA motion in the \textit{Low-$f$} response, the \textit{antipodal} mode is the only one that keeps pattern functions that are exactly degenerate with the injection: all other modes will move together with the time-dependent LISA frame. The antipodal mode is not moving, because the antipode of the true direction of the arriving signal  is defined as $k \rightarrow -k$ independently of the orientation of LISA; the only degeneracy-breaking term is then the orbital delay $k \cdot p_{0}$. With the \textit{Full} response, by contrast, frequency dependency terms in~\eqref{eq:Gslr} featuring $k\cdot n_{l}$, $k \cdot p_{s,r}$ readily break this antipodal degeneracy.

\begin{table}\label{tab:MBHBdegen}
	\begin{tabularx}{.48\textwidth}{|X||c|c|c|c|}
		\hline
		Sky mode & \textit{Full} & \textit{Frozen} & \textit{Low-$f$} & \textit{Frozen low-$f$} \\
		\hline
		\textit{reflected}: \newline $-\betaL$, $\lambdaL$ & $t$-dep. & degen. & $t$-dep. & degen.  \\
		\hline
		\textit{antipodal}: \newline $-\betaL$, $\lambdaL + \pi$ & $f$-dep.$+\Delta \Phi_{R}$ & $f$-dep. & $\Delta \Phi_{R}$ & degen.  \\
		\hline
		$\betaL$, $\lambdaL + \pi/2$ & $t$-$f$-dep. & $f$-dep. & $t$-dep. & degen.  \\
		\hline
		$\betaL$, $\lambdaL + \pi$ & $t$-$f$-dep. & $f$-dep. & $t$-dep. & degen.  \\
		\hline
		$\betaL$, $\lambdaL - \pi/2$ & $t$-$f$-dep. & $f$-dep. & $t$-dep. & degen.  \\
		\hline
		$-\betaL$, $\lambdaL + \pi/2$ & $t$-$f$-dep. & $f$-dep. & $t$-dep. & degen.  \\
		\hline
		$-\betaL$, $\lambdaL - \pi/2$ & $t$-$f$-dep. & $f$-dep. & $t$-dep. & degen.  \\
		\hline
	\end{tabularx}
	\caption{Sketch of the degeneracy structure of the eight modes in the sky, with the cases where the degeneracy is exact (degen.), and with the qualitative effects that break the degeneracy with the injected signal: $t$-dependency, $f$-dependency, both, or only the Doppler phase $\Delta \Phi_{R}$. This qualitative structure is the same with and without higher harmonics.}
\end{table} 

Thus, we have found that in the \textit{Frozen low-$f$} approximation for the response we expect a pattern of degeneracy of eight degenerate positions in the sky (with certain rules for inclination and polarization). Table~\ref{tab:MBHBdegen} summarizes the qualitative picture of degeneracy breaking by the features of the response. We will see in Sec.~\ref{sec:SMBHPEacctime} that the eight-mode degeneracy pattern indeed appears when doing a pre-merger analysis; on the other hand, in results Figs.~\ref{fig:PEsmbh22hmCase0} and~\ref{fig:PEsmbh22hmCase9} for full IMR signals, out of the eight possible sky modes only the \textit{reflected} mode~\eqref{eq:degenreflection} survives. We will investigate in detail in Sec.~\ref{sec:SMBHPEacctime} how time-dependence and frequency-dependence in the response break part, but not all, of the degeneracies.

However, this analysis does not explain why one obtains, with a zero noise realization, marginalized posteriors for the sky positions that appear biased from the injected signal, when ignoring higher harmonics. This is the question that we will address in the next Section.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Apparent biases in the absence of higher harmonics}
\label{subsec:MBHBPEdegen22}

\begin{figure}
  \centering
  \begin{minipage}{.49\linewidth}
  \includegraphics[width=.99\linewidth]{../plots/corner_skydown_smbh_case9_22_ptmcmc_bambi_withdegen.png}
  \end{minipage}
  \begin{minipage}{.49\linewidth}
  \includegraphics[width=.99\linewidth]{../plots/corner_skydown_smbh_case9_simplelike_ptmcmc_bambi_withdegen.png}
  \end{minipage}
  \caption{Sky position posterior in presence of degeneracies, zooming close to the injected value. The left panel shows the complete likelihood, while the right panel shows the simplified likelihood~\eqref{eq:simplelikelihoodhm} with a motionless LISA and fixed masses and time. The results of \texttt{PTMCMC} (blue) and \texttt{MultiNest} are superimposed. The black cross is the injected value, and the grey cross is the analytic prediction~\eqref{eq:soldegensky} for the offset peak created by degeneracies.}
  \label{fig:Skydownsmbh22hmSimpleLikeCase9}
\end{figure}

In this section, we investigate the cause of the degeneracies appearing in the posterior of Case~II shown in~\ref{subsec:SMBHPE}. Understanding the structure of these features could prove useful to inform Bayesian samplers, for instance by building adapted jump proposal allowing a much faster mixing of MCMC chains than naive methods. a simplified form of the extrinsic likelihood and the structure of its degeneracies.

An important clue about the appearance of these degeneracies is the length of the observable signal. As shown in Fig.~\ref{}, for our example SMBH systems the SNR accumulates in a matter of days before merger, which means that there is only little impact of the modulations caused by the motion of the detector on the TDI transfer functions~\eqref{}. If we can neglect entirely the motion of the detector (which is not quite true as we will see later on), then we are in a regime where the information about the sky position of the source comes essentially from the pattern functions affecting this high-SNR signal. Using the low-frequency approximation (see~\ref{}) and the time-at-LISA $t_{L}$ as a time variable, there is no frequency dependence in the response. A further simplification occurs when pinning the masses and the time of coalescence to their true values. We found indeed that these parameters correlate only weakly to the other ones, so that we can hope to understand the degeneracy features by restricting the analysis to the six extrinsic parameters $(D_{L}, \iota, \varphi, \lambdaL, \betaL, \psiL)$. \TDC{we could make the connection with a similar decoupling in LIGO/Virgo, which is actually what makes low-latency sky localization possible.}

Under all these simplifying assumptions, the likelihood function becomes purely extrinsic, and takes the form of trivial geometric factors multiplying a constant overlap that can be precomputed. Using the subscript $\mathrm{inj}$ for the injected signal, the likelihood~\eqref{eq:defliklihood} is
\be
	\ln \calL = -\frac{1}{2} \left( \tilde{a} - \tilde{a}_{\rm inj} | \tilde{a} - \tilde{a}_{\rm inj} \right) -\frac{1}{2} \left( \tilde{e} - \tilde{e}_{\rm inj} | \tilde{e} - \tilde{e}_{\rm inj} \right) \,.
\ee
From the low-frequency response \eqref{eq:aelowfmodes}, pinning the time-at-LISA~\eqref{} \SM{to be completed for $t_{L}$} so that we can ignore the factor $\exp [2 i \pi f k\cdot p_{0}]$ as a pure constant corresponding to a redefinition of time, we obtain \JGB{Should we use notation $\Phi_R$ here and in \eqref{eq:aelowfmodes}?}
\begin{align}\label{eq:simplelikelihoodhm}
	\ln \calL &= -\frac{1}{2} \sum_{\ell m} \sum_{\ell' m'}   \left[ \left( s_{a}^{\ell m} - s_{a, \mathrm{inj}}^{\ell m}\right) \left( s_{a}^{\ell' m'} - s_{a, \mathrm{inj}}^{\ell' m'}\right)^{*} \right. \nn\\
	& \qquad \left. + \left( s_{e}^{\ell m} - s_{e, \mathrm{inj}}^{\ell m}\right) \left( s_{e}^{\ell' m'} - s_{e, \mathrm{inj}}^{\ell' m'}\right)^{*} \right] \left\langle \ell m | \ell' m' \right\rangle \,,
\end{align}
where we introduced the following extrinsic signal functions \JGB{Since neither $D_{a,e}$ nor $P_{\ell m}$ are defined in the main text, may be better to write in terms of a version of $F$ as in \eqref{eq:defFapcFepc}}
\be\label{eq:defsaelm}
	s_{a,e}^{\ell m} = \frac{1}{d} \frac{2}{3L} D_{a,e} : P_{\ell m} \,,
\ee
with $d = D_{L} / D_{L}^{\rm inj}$ the dimensionless ratio of luminosity distances. The prefactors $\left\langle \ell m | \ell' m' \right\rangle$ \sout{are pure normalization constants, and} represent mode overlaps as
\be\label{eq:innerproductlmlpmp}
	\left\langle \ell m | \ell' m' \right\rangle = 4\mathrm{Re} \int \frac{df}{S_{n}^{a,e}} \left( 3 \pi f L\right)^{2} \tilde{h}_{\ell m} \tilde{h}_{\ell' m'}^{*} \,.
\ee
Here, the noise PSD $S_{n}^{a,e}$ is given by~\eqref{} and is identical between the channels $a$ and $e$. Having fixed the masses and the time, these overlaps are to be computed with the modes $\tilde{h}_{\ell m}^{\rm inj}$ of the injected signal.

In the case where we only include the dominant harmonic $h_{22}$, the likelihood~\eqref{eq:simplelikelihoodhm} simplifies to
\be\label{eq:simplelikelihood22}
	\ln \calL = -\frac{1}{2} \left\langle 22 | 22 \right\rangle  \left[ \left| s_{a}^{22} - s_{a, \mathrm{inj}}^{22} \right|^{2} + \left| s_{e}^{22} - s_{e, \mathrm{inj}}^{22}\right|^{2} \right] \,.
\ee
The functions~\eqref{eq:defsaelm} take the explicit form
\begin{align}
	s_{a,e}^{22} &= \frac{1}{4d} \sqrt{\frac{5}{\pi}} \cos^{4}\frac{\iota}{2} e^{2i(\varphi-\psiL)} \left( F_{a,e}^{+} + i F_{a,e}^{\times} \right) \\
	&+ \frac{1}{4d} \sqrt{\frac{5}{\pi}} \sin^{4}\frac{\iota}{2} e^{2i(\varphi+\psiL)} \left( F_{a,e}^{+} - i F_{a,e}^{\times} \right) \,,
\end{align}
with the pattern functions for the channels $a$ and $e$ defined in \eqref{eq:defFapcFepc}-\eqref{eq:FapcFepc}.

In order to make more manifest the degeneracies in the problem, it will be useful to introduce the following notations. First, since $\iota \in [0, \pi]$ while $\beta_{L} \in [-\pi/2, \pi/2]$, it will be more convenient to work with $\theta_{L} = \pi/2 - \beta_{L}$. We will further abbreviate notations by using the variables
\be
	t_{\iota} \equiv \tan \frac{\iota}{2} \,, \quad t_{\theta} \equiv \tan \frac{\theta_{L}}{2} \,.
\ee
We also introduce the azimuthal angles $\lambda_{a} = \lambda_{L} - \pi/6$, $\lambda_{e} = \lambda_{L} + \pi/12 = \lambda_{a} + \pi/4$, and form the combinations
\be
	\sigma_{\pm} \equiv \frac{1}{2} \left[ s_{a}^{22} \pm i s_{e}^{22} \right] \,.
\ee
In these notations, we obtain
\bsub\label{eq:sigmapm}
\begin{align}
	\sigma_{+} &= \rho e^{2i\varphi} \left[ t_{\theta}^{4} e^{-2 i \psiL} + t_{\iota}^{4} e^{2 i \psiL} \right] e^{-2i \lambda_{a}} \,, \\
	\sigma_{-} &= \rho e^{2i\varphi} \left[ e^{-2 i \psiL} + t_{\theta}^{4} t_{\iota}^{4} e^{2 i \psiL} \right] e^{2i \lambda_{a}} \,,
\end{align}
\esub
with a common prefactor \JGB{This seems to need to  be multiplied by -6 to get what I have in my notes. Trace to change in def of $s_{a,e}$?}
\be\label{eq:sigmafactorrho}
	\rho(d, \iota, \theta_{L}) = \frac{1}{4d} \sqrt{\frac{5}{\pi}} \frac{1}{\left( 1 + t_{\iota}^{2} \right)^{2} \left(1 + t_{\theta}^{2} \right)^{2}} \,.
\ee
Finding points in the parameter space that are degenerate with the injection, i.e. with $\ln \calL \simeq 0$, amounts finding choices for the parameters which obtain the same values as the injection for both quantities $\sigma_{+}$ and $\sigma_{-}$.

We can now use the simplified response written in the form~\eqref{eq:sigmapm}-\eqref{eq:sigmafactorrho} to look for symmetries and degeneracies. First, we note the following manifest symmetry: changing simultaneously
\be\label{eq:symmetryresponse}
	\betaL \rightarrow -\betaL\,, \quad \iota \rightarrow \pi - \iota \,, \quad \psiL \rightarrow \pi - \psiL
\ee
leaves the likelihood exactly invariant. There is also a symmetry based on exchanging $\iota \leftrightarrow \theta_{L}$. While leaving $\sigma_-$ unchanged, this conjugates the factor inside brackets for $\sigma_{+}$, which can be compensated using the phase terms $\varphi \pm \lambda_{a}$. If $\Phi = \mathrm{Arg} \left[ t_{\theta}^{4} e^{-2 i \psiL} + t_{\iota}^{4} e^{2 i \psiL} \right]$, we obtain the symmetry
\begin{align}
	\iota' = \theta_{L} \,, \qquad \theta_{L}' = \iota \,, \nn\\
	\varphi' = \varphi + \frac{1}{2} \Phi \quad \mathrm{mod} \; \pi\,, \nn\\
	\lambda_{a}' = \lambda_{a} - \frac{1}{2} \Phi \quad \mathrm{mod} \; \pi\,.
\end{align}

\JGB{Don't have to resort to limits.}
\sout{We can now explain the degenerate features we found as certain limits in this simplified likelihood. In the face-on or face-off limit $\iota \rightarrow 0$, $|t_{\iota}| \ll 1$. This amounts to the $(\ell,m)=(2,2)$ contribution dominating the $(\ell, m)=(2,-2)$ contribution. Neglecting the terms in~\eqref{eq:sigmapm} that are quartic in $t_{\iota}$, we have}
%\bsub\label{eq:sigmapmapprox}
%\begin{align}
%	\sigma_{+} &\simeq \rho e^{2i(\varphi - \psiL)} t_{\theta}^{4} e^{-2i \lambda_{a}} \,, \\
%	\sigma_{-} &\simeq \rho e^{2i(\varphi - \psiL)} e^{2i \lambda_{a}} \,,
%\end{align}
%\esub

Beyond these discrete symetries, since likelihood function dependence on the six extrinsic parameters is funneled through just two complex functions, we should expect a two-dimensional degenerate subspace.  Indeed we can explicitly find a general solution for parameter values that solve $\sigma_{\pm}((D_{L}, t_\iota, t_\theta \varphi, \lambda_a, \psiL)=\sigma_{\pm,{\rm inj}}$, which we just sketch here, as needed to explain features of the degeneracies.

Defining the ratio
\be
	r(\lambda_a, t_\iota, t_\theta, \psiL) = \frac{\sigma_{+}}{\sigma_{-}} \,,
\ee
makes clear that $r=r_{\rm inj}$ provides one complex condition on 4 real unknown parameters, eliminating parameters $D_{L}$ and $\varphi$ while retaining the features of the full degenerate subspace.  Going further, $|r|^2=|r_{\rm inj}|^2$ yields one condition on 3 parameters, eliminating $\lambda_a$.  In fact, with a little rearrangement, this can be written as a quadratic expression for either $t_\iota^4$ or $t_\theta^4$ for an explicit solution.  Depending on the value of $|r_{\rm inj}|^2$, values of $\psiL$ and the independent variable ($t_\theta$ or $t_i$) can always be chosen to guarantee a real, positive solution.

Given a solution for $(t_\iota,t_\theta,\psi_L)$, the rest of the solution then proceeds backwards. An explicit expression for commensurate $\lambda$ comes from solving $r=r_{\rm inj}$, and then $D_L$ and $\varphi$ are obtained from solving, e.g., $s_+=s_{+,{\rm inj}}$.

In the limit that the independent variable is given a value far from unity (near polar $\iota$ ot $\beta_L$), then the solution for the dependent variable approaches a fixed constant special values $t_{\iota,\theta}^4={|r_{\rm inj}|^{\pm1}}$, with leading order corrections proportional to  $t_{\theta,\iota}^{4}$.  A large part of the degenerate subspace volume then tends to found with parameters $\iota$ ot $\beta_L$ near these special values with corresponding constraints on $\lambda$ coming from the solution for the complex argument of $r$.

In terms of the original parameters then, if we consider inferences with the parameter $\iota$ that is not near the source equator, then we find a significant part of the degenerate maximum-likelihood parameter space volume near the special sky positions
\bsub
\begin{align}
  \beta_L&\approx{\beta_L}^{*}=\pm\left(\frac{\pi}{2} - 2 \mathrm{Arctan} \; \left| r_{\rm inj}\right|^{1/4} \right)\,, \\
  \lambda_a&\approx {\lambda_a}^{*}=\frac{\pi}{6} -\frac{1}{4} \mathrm{Arg} \; r_{\rm inj} \;\mathrm{mod}\; \frac{\pi}{2} \,,\\
  \rho e^{2i(\varphi-\psiL)} &\approx e^{-2i\lambda_{a}^{*}} \sigma_{-}^{\rm inj} \,.
\end{align}
\esub
With the $\lambdaL \rightarrow \lambdaL + k \pi/2$ and $\betaL \rightarrow - \betaL$ symmetries, we arrive at eight sky positions where the degeneracy occurs, with an exact degeneracy for the pair of parameters $(\varphi, \psiL)$, as well as an approximate degeneracy for the pair $(d, \iota)$ as long as we remain in the regime $t_{\iota}^{4} \ll 1$ or $t_{\iota}^{4} \gg 1$ (which is quite extended, thanks to the quartic power). For each of these sky positions built from~\eqref{eq:soldegensky}, many different values of $(\varphi, \psiL)$ and $(d, \iota)$ produce a waveform very close to the injection, resulting in apparent peaks in the marginalized posterior distribution for the sky position, located at the special sky positions $(\lambda_{a}^{*}, \theta_{L}^{*})$, which are offset from the injected value.

Without special tuning, the injected sky position which led to the given values of $s_{a,\mathrm{inj}}$ and $s_{e,\mathrm{inj}}$ is correspondingly likely to have been near one of these sky locations, but it may not have been. In those cases the posterior\ldots

Similarly, considering inferred locations away from the LISA-constellation plane, we find a significant part of the degenerate parameter space near special values for inclination and correspondingly for $\lambda_L+\varphi$
\bsub
\begin{align}
	\iota&\approx\iota^{*} = 2 \mathrm{Arctan} \; \left| r_{\rm inj}\right|^{1/4} \,, \\
	\lambda_a-\psiL&\approx (\lambda_{a} - \psiL)^{*} = -\frac{1}{4} \mathrm{Arg} \; r_{\rm inj} \;\mathrm{mod}\; \frac{\pi}{2} \,\\
        \rho e^{2i\varphi} &\approx e^{-2i (\lambda_{a} - \psi_{L})^{*}} \sigma_{-}^{\rm inj} \,.
\end{align}
\esub



%finding $(\lambda_{a}^{*}, \theta_{L}^{*})$ verifying
%\be\label{eq:degenconditionsky}
%	\frac{\sigma_{+}}{\sigma_{-}} (\lambda_{a}^{*}, \theta_{L}^{*}) = r_{\rm inj} \,,
%\ee
%with the approximation~\eqref{eq:sigmapmapprox} for the left-hand side, guarantees that we can then match both $\sigma_{+}$ and $\sigma_{-}$ of the injection with the condition
%\be\label{eq:degenconditionprefactor}
%	\rho e^{2i(\varphi - \psiL)} e^{2i \lambda_{a}^{*}} = \sigma_{-}^{\rm inj}\,.
%\ee
%In the limit $|t_{\iota}| \ll 1$,
%\be
%	\frac{\sigma_{+}}{\sigma_{-}} \simeq t_{\theta}^{4} e^{-4i\lambda_{a}} \,,
%\ee
%so that~\eqref{eq:degenconditionsky} is verified for special positions in the sky at (coming back to the original variables $(\lambdaL, \betaL)$)
%\bsub\label{eq:soldegensky}
%\begin{align}
%\beta_{L}^{*} &= \frac{\pi}{2} - 2 \mathrm{Arctan} \; \left| r_{\rm inj}\right|^{1/4} \,, \\
%	\lambda_{L}^{*} &= \frac{\pi}{6} -\frac{1}{4} \mathrm{Arg} \; r_{\rm inj} \;\mathrm{mod}\; \frac{\pi}{2} \,.
%\end{align}
%\esub
\JGB{Keep something from this?}
The other condition~\eqref{eq:conditionprefactor} gives then a single phase constraint for $\varphi - \psiL$, and a single amplitude constraint for $\rho(d, \iota, \theta_{L}^{*})$. The limit $\iota \rightarrow \pi$ (where the $(2,-2)$ contribution dominates the $(2,2)$) is very similar, as can be seen most easily by the change of variable $\iota \rightarrow \pi - \iota$, with $-\psiL$ and $\pi - \theta_{L}$ playing the roles of $\psiL$ and $\theta_{L}$.


%We can further find the same mechanism, with a few differences, by exchanging the roles of $(\iota, \varphi)$ and $(\theta_{L}, \lambda_{a})$, as follows. In the limit $\theta_{L} \rightarrow 0$ with $|t_{\theta}| \ll 1$, we have this time
%\be
%	\frac{\sigma_{+}}{\sigma_{-}} \simeq t_{\iota}^{4} e^{-4i(\lambda_{a} - \psi_{L})} \,,
%\ee
%which gives in the same way a degeneracy if
%\bsub\label{eq:soldegeniotaphi}
%\begin{align}
%	\iota^{*} &= 2 \mathrm{Arctan} \; \left| r_{\rm inj}\right|^{1/4} \,, \\
%	(\lambda_{a} - \psiL)^{*} &= -\frac{1}{4} \mathrm{Arg} \; r_{\rm inj} \;\mathrm{mod}\; \frac{\pi}{2} \,,
%\end{align}
%\esub
%with a condition on $\rho$ and $\varphi$ that is now
%\be
%\rho e^{2i\varphi} e^{2i (\lambda_{a}^{*} - \psi_{L}^{*})} = \sigma_{-}^{\rm inj} \,.
%\ee
\JGB{Keep something from this?}
Thus, we find again a degenerate pattern, with the difference that \eqref{eq:soldegeniotaphi} imposes a condition on the pair $\lambda_{a} - \psiL$ instead of $\lambda_{a}$, and the extra condition imposes a condition on $\varphi$ instead of the pair $\varphi - \psiL$.

When considering more harmonics beyond the dominant mode $h_{22}$, such degeneracies will be broken easily. As in the case of the full likelihood, the simplified likelihood~\eqref{eq:simplelikelihoodhm} will have several terms with different inclination and phase dependencies. If the signal is loud enough for at least two modes to be detected, then the inclination $\iota$ and the phase $\varphi$ are fixed by the relative amplitude and phase of these modes. This will break the degeneracies $(d, \iota)$ and the degeneracy $(\varphi, \psiL)$.

We illustrate our findings by running a Bayesian parameter estimation for the simplified likelihood~\eqref{eq:simplelikelihood22} with the two samplers \texttt{MultiNest} and \texttt{PTMCMC} described in Sec.~\ref{}. Since the inner products~\eqref{eq:innerproductlmlpmp} are constants computed only once, the external factors become trivially inexpensive, and the likelihood is very fast to compute. We take advantage of this to run \texttt{PTMCMC} for a very large number of steps, ensuring that we do not miss degenerate regions of the parameter space. The resulting posterior distribution is extremely degenerate, as shown in Fig.~\ref{fig:PEsmbh22hmSimpleLikeCase9}. The sampler \texttt{MultiNest} fails to resolve this structure, stopping after having only explored the degenerate region $\iota \rightarrow 0$ and $\iota \rightarrow \pi$ and the eight sky positions~\eqref{eq:soldegensky}. In accordance with~\eqref{eq:degenconditionsky}-\eqref{eq:degenconditionprefactor}, this corresponds to lines in $\varphi \pm \psiL = \mathrm{const}$. The sampler \texttt{PTMCMC} finds more degenerate regions, in particular it finds similar structures with the roles of $\iota$ and $\betaL$ exchanged (as shown notably by the $(d,\iota)$ and $(d,\betaL)$ panels), as well as intermediate regions connecting all these features.

Fig.~\ref{fig:PEsmbh22hmSimpleLikeCase9} also shows the result obtained when including all available harmonics~\eqref{} in~\eqref{eq:simplelikelihoodhm}. The degenerate structures collapse to leave only eight modes corresponding to $\betaL \rightarrow - \betaL$ and $\lambdaL \rightarrow \lambdaL + k\pi/2$. We found that this degeneracy-breaking occurs already when including a single subdominant harmonic $h_{21}$.

We can now come back to explaining the results of Sec.~\ref{}, and in particular Fig.~\ref{}, obtained with the true likelihood function for the mode $h_{22}$. First, the difference between the two Bayesian samplers has been made more extreme by going to the more degenerate likelihood~\eqref{eq:simplelikelihood22}, allowing us to attribute their disagreement to an apparent shortcoming of \texttt{MultiNest}\footnote{We recall that we only used standard values for the metaparameters \SM{[complete]} for this sampler, and we do not exclude that it would be possible to improve results with minor changes.} for resolving extended degenerate regions. Focusing on the sky position, we zoom close to the injection in Fig.~\ref{fig:Skydownsmbh22hmSimpleLikeCase9}. We compare here the posterior distribution generated with the true likelihood with the one obtained with the simplified likelihood~\eqref{eq:simplelikelihood22}, for both samplers.  We also superimpose the prediction~\eqref{eq:soldegensky} for the degeneracy-induced peak. We see that, although ,

%\be\label{eq:symmetryresponse}
%\betaL \rightarrow -\betaL\,, \quad \iota \rightarrow \pi - \iota \,, \quad \psiL \rightarrow \pi - \psiL
%\ee
%leaves the signal unchanged. We can also rewrite the likelihood in a way that makes clearer the symmetry between the two pairs of parameters $(\iota, \varphiL)$ and $(\betaL, \lambdaL)$ \SM{[TODO]}.
%
%The simplified extrinsic likelihood for a frozen LISA then takes the form
%\be\label{eq:simplelikelihood}
%	\ln \calL = - \frac{1}{2} \Lambda \left( \left| s_{a} - s_{a}^{\rm inj} \right|^{2} + \left| s_{e} - s_{e}^{\rm inj} \right|^{2} \right) \,,
%\ee
%where $\Lambda$ appears as an overall normalization factor, playing the role of the square SNR of the signal.

%We can now explore possible degeneracies in the likelihood given by~\eqref{eq:simplelikelihood}, \eqref{eq:defsase} and \eqref{eq:defa22a2m2}-\eqref{eq:defe22e2m2}. We note that the relative contributions of the modes $h_{2,2}$ and $h_{2,-2}$ are strongly separated in the face-on or face-off limit, leading to a simplification of the response and an enhanced degeneracy. Due to the symmetry~\eqref{eq:symmetryresponse}, we will focus on the face-on limit $\iota \rightarrow 0$. In this limit, the $h_{2,-2}$ contributions die off rapidly as $a_{2,-2}\,, e_{2,-2} \sim \sin^{4} (\iota/2)$. If they are assumed to be negligible, then we can rewrite
%\bsub\label{eq:saseapprox}
%\begin{align}
%	s_{a} \simeq i\calA e^{2 i \xi} \left( D_{a}^{+} + i D_{a}^{\times} \right) \,, \\
%	s_{e} \simeq i\calA e^{2 i \xi} \left( D_{e}^{+} + i D_{e}^{\times} \right) \,,
%\end{align}
%\esub
%where we introduced the notations $\xi (\varphiL, \psiL) \equiv -\varphiL - \psiL$ and $\calA(d, \iota) \equiv 3/4\sqrt{5/\pi}\cos^{4}(\iota/2)/d $ for the common phase and amplitude factors.
%
%For a degeneracy to occur, both complex quantities $s_{a}$ and $s_{e}$ must be close to the injection values $s_{a}^{\rm inj}$ and $s_{e}^{\rm inj}$, which can be achieved as follows if~\eqref{eq:saseapprox} is valid. Defining the complex ratio
%\be\label{eq:defr}
%	r(\lambdaL, \betaL) = \frac{D_{a}^{+} + i D_{a}^{\times}}{D_{e}^{+} + i D_{e}^{\times} } \,,
%\ee
%if the position in the sky $(\lambda_{L}^{*}, \beta_{L}^{*})$ can be chosen so that
%\be\label{eq:rcondition}
%	r(\lambda_{L}^{*}, \beta_{L}^{*}) = \frac{s_{a}^{\rm inj}}{s_{e}^{\rm inj}} \,,
%\ee
%then adjusting $\calA$ and $\xi$ so that
%\be
%	i\calA e^{2 i \xi} = \frac{s_{a}^{\rm inj}}{\left( D_{a}^{+} + i D_{a}^{\times} \right)(\lambda_{L}^{*}, \beta_{L}^{*})}
%\ee
%generates degenerate points in parameter space with $\ln \calL \simeq 0$.
%
%The conditions~\eqref{eq:defr}-\eqref{eq:rcondition} can be inverted for the sky position as follows. For a given complex value of $r = s_{a}^{\rm inj} / s_{e}^{\rm inj}$, $r(\lambda_{L}^{*}, \beta_{L}^{*}) = r$ can be rewritten as
%\be\label{eq:eqtosolveforlambdabetaL}
%	e^{4i\lambda_{L}^{*}}e^{i\frac{\pi}{3}} \frac{\left( 1 +\sin\beta_{L}^{*} \right)^{2}}{\left( 1 - \sin\beta_{L}^{*} \right)^{2}} = \frac{1+ i r}{1 - i r} \,.
%\ee
%Solving for the modulus of~\eqref{eq:eqtosolveforlambdabetaL} then yields
%\be\label{eq:solutionbetaL}
%	\sin\beta_{L}^{*} = \frac{\rho - 1}{\rho + 1} \,,
%\ee
%for
%\be
%	\rho = \sqrt{\left| \frac{1+ i r}{1 - i r} \right|} \,.
%\ee
%Solving for the argument of~\eqref{eq:eqtosolveforlambdabetaL} gives four solutions for $\lambda_{L}^{*}$ as
%\be\label{eq:solutionlambdaL}
%	\lambda_{L}^{*} = - \frac{\pi}{12} + \frac{1}{4}\mathrm{Arg} \frac{1+ i r}{1 - i r} + \frac{k \pi}{2} \quad \mathrm{for} \quad k = 0,\dots,3 \,.
%\ee
%
%Repeating the argument for the other branch of solutions $\iota \rightarrow \pi$ (or directly considering the symmery~\eqref{eq:symmetryresponse}) gives four other solutions in the sky with identical sky longitudes $\lambda_{L}^{*}$, with symmetrized sky latitudes $\beta_{L}^{*} \rightarrow -\beta_{L}^{*}$, and with $\xi (\varphiL, \psiL) \equiv -\varphiL + \psiL$, $\calA(d, \iota) \equiv 3/4\sqrt{5/\pi}\sin^{4}(\iota/2)/d $.
%
%Thus, with~\eqref{eq:solutionbetaL}, \eqref{eq:solutionlambdaL} and $\beta_{L}^{*} \rightarrow -\beta_{L}^{*}$, we arrive at eight degenerate positions in the sky $(\lambda_{L}^{*}, \beta_{L}^{*})$. For each of these sky positions, an exact line degeneracy exists between $\varphiL$ and $\psiL$ as long as $\xi = \mathrm{const}$, as well as an approximate line degeneracy between $d$ and $\iota$, as long as $\calA = \mathrm{const}$, limited to inclination values where $\sin^{4}(\iota/2)$ (or $\cos^{4}(\iota/2)$, for the other branch of solutions) remains negligible. The combination of these degeneracies generates an extended structure in the multi-dimensional parameter space. As a result, when considering the marginal posterior for the sky position, these degenerate spots in the sky can have a lot of probability support.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Massive black holes: accumulation of information with time}
\label{sec:MBHBPEacctime}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Pre-merger analysis}
\label{subsec:MBHBacctimePE}

The rate at which parameter information accumulates LISA merger observations is crucial for planning strategies for multi-messenger observations and in guiding the latency demands of the LISA down-link and data processing. We explore how parameter information accumulates on approach to merger by performing parameter estimation studies temporally truncated signals, cut at points where the accumulated SNR is about $\{10,42,166\}$ corresponding to $\{1/64,1/16,1/4\}$ of the total SNR=$666.0$, and times $\{41 \mathrm{hr}, 2.5 \mathrm{hr}, 7 \mathrm{min}\}$ before merger.

\begin{figure*}
  \centering
  \begin{minipage}{.48\linewidth}
      \includegraphics[width=.99\linewidth]{../plots/t-of-F.pdf}
   \end{minipage}
   \begin{minipage}{.48\linewidth}
      \includegraphics[width=.99\linewidth]{../plots/t-of-SNR.pdf}
   \end{minipage}
  \caption{\SM{Redo left plot, right plot redundant with mode-by-mode SNR} Relations of time, Fourier frequency, and accumulated SNR for $M=2\times 10^6$,$q=3$ merger at $z=4$. The left panel shows times computed from $\tilde h(f)$ using Eq.~eref{eq:t-of-f}, and are approximately common among the waveform component modes up to minutes before merger. We use this relation to simulate time-cuts of the signals a various points before merger.  The right panel shows how SNR accumulates with time, though the full signal has a high SNR of about 666.0, most SNR accumulates very late. The curves shown extend from approximately SNR=1 until $t(f)$ is 40s after nominal merger.  The stars show points where the SNR has reached $\{1/4,1/16,1/64\}$ of the full-signal total, where we have studied parameter estimate for temporally incomplete signals.}
  \label{fig:t-f-snr-Case9}
\end{figure*}

We implement these temporal cuts in the Fourier domain, using Eq.XXXX, the $t(f)$ relation inferred from the smoothly chirping harmonic mode components of the waveforms as part of the LISA response.  This is a good approximation for temporal cuts, and consistent among the various modes for our cuts, which are sufficiently early before merger, as shown in Fig.~\ref{fig:t-f-snr-Case9}.

The right panel of the figure also shows the times before merger at which a given value of SNR is reached.  In this case the signal begins being relevant, reaching SNR~1 about 34 days before merger, but reaches a plausible first-detectability threshold about 41 hours before merger. Most of the SNR accumulates over the last few minutes of signal.

In Fig.~\ref{fig:smbhCornerZoomHMCase9} and Fig.~\ref{fig:MollweidesmbhTserieshmCase9} we show how parameter information accumulates at these time points.  Individual masses are within a factor of 2 at first detection and better than $10\%$ by 41 hours before merger.  Distance within a factor of 2 at 41 hours and within roughly $10\%$ at 2.5 hours prior to merger. Merger time is estimated to about an hour at first detection, and within a few minutes by 2.5 hours before merger.  Sky position...

\begin{figure*}
  \centering
  \begin{minipage}{.32\linewidth}
      \includegraphics[width=.99\linewidth]{../plots/corner_smbh_case9_hm_tseries_m1m2.png}
   \end{minipage}
   \begin{minipage}{.32\linewidth}
      \includegraphics[width=.99\linewidth]{../plots/corner_smbh_case9_hm_tseries_Dinc.png}
   \end{minipage}
   \begin{minipage}{.32\linewidth}
      \includegraphics[width=.99\linewidth]{../plots/corner_smbh_case9_hm_tseries_tphi.png}
   \end{minipage}
  \caption{.}
  \label{fig:smbhCornerZoomHMCase9}
\end{figure*}

\begin{figure*}
  \centering
  \includegraphics[width=.8\linewidth]{../plots/skymap_Lframe_tseries_bambi_22.png}
  \includegraphics[width=.8\linewidth]{../plots/skymap_Lframe_tseries_ptmcmc_hm.png}
  \caption{.}
  \label{fig:MollweidesmbhTserieshmCase9}
\end{figure*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Degeneracy breaking by the time and frequency dependence in the response}
\label{subsec:MBHBacctimebreakdegen}

\begin{figure*}
  \centering
  \includegraphics[width=.99\linewidth]{../plots/lnL_skymodes_approx_22.pdf}
  \includegraphics[width=.99\linewidth]{../plots/lnL_skymodes_approx_hm.pdf}
  \caption{for different response approximations (from left to right: \textit{Full}, \textit{Frozen}, \textit{Low-$f$}), with 22-mode only (top) and with higher harmonics (bottom). A very negative $\ln\calL$ values means that this point is excluded by the inference. \SM{do we need a table of post-merger lnL values ?}}
  \label{fig:lnLskymodesapprox}
\end{figure*}

We have found that pre-merger analysis of the previous section made apparent the degeneracy pattern that can be predicted analytically from the structure of the \textit{Frozen, low-$f$} response approximation. Analyses of IMR signals as in~\ref{sec:MBHBPE} show that only the \textit{reflected} mode~\eqref{eq:degenreflection} survives post-merger. In this Section we explain how and why this transition occurs.

We have already presented a discussion of different qualitative effects in the instrument response in Sec.~\ref{MBHBresponseapprox} and Fig.~\ref{responseapproxtdia22}: one hand hand, the motion of LISA leaves an imprint (the time-dependency) on the low frequencies, where the time-to-frequency map is steep enough that a short interval in frequency maps to a large interval of time; on the other hand, the breakdown of the long-wavelength approximation leaves an imprint (the frequency-dependency) at high frequencies. Here we look at the quantitative importance of these features on the inference as a function of frequency (or as a function of time). We can readily select one or the other feature by using the \textit{Frozen} response, ignoring time dependency, or the \textit{Low-$f$} response, ignoring frequency dependency.

In Fig.~\ref{fig:lnLskymodesapprox} we show log-likelihood values obtained with either the \textit{Full}, \textit{Frozen} or \textit{Low-$f$} response, with and without higher harmonics, for each of the eight modes in the sky described by~\eqref{eq:degenreflection}-\eqref{eq:degenlambdapi2}. The likelihood~\eqref{eq:deflnLaet} is computed with the same response approximation is used for the injection and for the template. The results are shown as a function of frequency in a cumulative sense: we compute the likelihood by accumulating signal up to the frequency shown in the $x$-axis. When including higher harmonics, this cut in frequency is interpreted as a cut in time and propagated to other harmonics according to~\eqref{eq:fscalinglm}.

A value of $\ln \calL = 0$ means that the template signal with shifted parameters is identical to the injection, while a very negative $\ln \calL$ means that these parameter values are excluded by the inference. The injection (full black line) has always $\ln \calL = 0$ by construction. The \textit{reflected} sky mode~\eqref{eq:degenreflection} is the dashed black line, and the \textit{antipodal} sky mode~\eqref{eq:degenanitpodal} is the dashed red line. 

With the \textit{Low-$f$} response, the \textit{antipodal} mode remains almost exactly degenerate with the injection, differing only by the Doppler phase~\eqref{eq:defPhiR}, which has a small effect on our short signals as shown in Fig.~\ref{fig:tranferSMBHCase9}. As explained below~\eqref{eq:degenantipodal}, other modes fail to reproduce the injected signal because of the time-dependence of the pattern functions. They acquire a moderate penalty at low frequency, but $\ln \calL$ then goes to a constant since the motion becomes negligible at high frequencies, as shown by the transfer functions in Fig.~\ref{fig:responseapproxtdia22}.

With the \textit{Low-$f$} response, the \textit{reflected} mode remains exactly degenerate as anticipated in Sec.~\ref{subsec:MBHBPEdegen}. All other modes see their $\ln \calL$ fall rapidly at around $2\mHz$ due to the onset of frequency-dependency in the response. Comparing to Fig.~\ref{fig:responseapproxtdia22}, we see that around $2\mHz$ the breaking of the long-wavelength approximation is still mild; however, the SNR start to accumulate a lot from $\SNR/16 \sim 40$ at $2.5\, \mathrm{h}$ to $\SNR/4 \sim 160$ at $7\min$, magnifying the effect of these features. Comparing the two rows of the figure, we see that the higher harmonics have an effect here, in making the elimination of secondary modes happen earlier in frequency (or time). This is expected as they start to contribute significantly to the SNR (see Fig.\ref{fig:modeoverlapsoftime}) and reach higher in frequency than the $h_{22} harmonic$ according to~\eqref{eq:fscalinglm}.

The \textit{Low-$f$} response case is essentially a superposition of the previous two response approximations. The early sky localization is quite poor and relies on the LISA motion. Getting closer to merger We stress that the . Overall, including the higher harmonics does not change this qualitative picture, despite an earlier onset of frequency-dependent degeneracy-breaking features.

Limitations of such explorations should be made clear: by using a pointwise estimate, we cannot make statistical statements and are missing volume effects discussed in Sec.~\ref{subsec:MBHBPEdegen22}; by transforming the angular parameters with an analytical prescription while keeping the other fixed, we are in a sense overconstraining the degeneracy. In particular, it is conceivable that one could find a better match to the injection in the vicinity of a degenerate sky mode, by adjusting slightly all parameters.

This is indeed what happens in multidmensional Bayesian parameter estimation, and is illustrated in Fig.~\ref{fig:lnLskymodesapprox}: in the first panel, for the three pre-merger analyses as well as for the post-merger analysis, we overlay circles indicating the best $\ln \calL$ found among the posterior samples, in each eighth of the sky corresponding to the eight sky modes (when no samples are present in this region of the sky, nothing is displayed). A sampler is not an optimizer, so the precise value achieved is not optimal and would vary when repeating runs; nevertheless, this measure gives a good proxy for how much closer of the injected signal we could get by slightly biasing the parameters.

We see that the best $\ln \calL$ among samples can be higher than the point estimate would tell us, especially for the analysis at $\sim 7 \min$ before merger, and higher harmonics make a visible difference. This has consequences for approximations like the Fisher analysis, if secondary peaks are shifted from the analytical predictions. We leave for future work the investigation of approximate representations of sky degeneracies.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Stellar origin black holes}
\label{sec:SOBH}

-- SOBH system, SNR sufficient for clean analysis + Fisher - stacked SNR contours
-- Performance: waveform and likelihood costs, number of sampler evaluations

Stellar-origin black-hole (SOBH) mergers have been recently recognized as an
important source of LISA detections \cite{Sesana16} although full parameter
estimation studies are not available yet. In this section we present two case
studies of parameter inference for such sources using the formalism and methods
described earlier. The parameters of the simulated mergers are taken from the
Radler LISA data challenge and are listed in Table \ref{table:sobh_params}.
\begin{table}
	\begin{tabular}{|c||c|c|}
		\hline
		Radler entry 		& 1 	& 12   \\
		\hline
		Mass 1 ($\Msol$) 	& 21.4	& 63.5 \\
		\hline
		Mass 2 ($\Msol$) 	& 20.1	& 45.1 \\
		\hline
		Distance (Mpc) 		& 49.1	& 318  \\
		\hline
		LISA SNR 			& 26.6	& 11.9 \\
		\hline
	\end{tabular}
	\caption{Parameters of the simulated SOBH mergers. \TDC{Maybe we can show
			 these on the upper right of each corner plot instead.}}
	\label{table:sobh_params}
\end{table}

We caution the reader that our purpose here is to show the feasibility of
Bayesian inference for SOBH sources in LISA using the methodology presented in
this paper. It is by no means a final answer on how to do so in an optimal or
convenient way.  For this reason, the problem is posed in a simplified
way here: in particular, the SOBH signal is assumed to merge roughly at the end of
the observation epoch, and the finite observation time is enforced by
converting it to a minimum analyzed Fourier frequency via the time-frequency
relation of a simple Newtonian inspiral. In a more realistic situation, the
merger time would likely be free to range from the beginning of the observation
to years after its end, and the frequency of the signal at the beginning of the
observation would be another sampling parameter.

The waveform model used to work with SOBH systems is the same phenomenological
approximant \texttt{EOBNRv2HMROM} used earlier, extended at low frequency with a post-Newtonian
frequency-domain waveform. In practice, because LISA only observes the early
inspiral of SOBH systems, only the post-Newtonian waveform plays a role here.
We do not expect radiation modes beyond the quadrupole to give a significant
contribution to the parameter estimates, so we only include the $(2,2)$ mode
for simplicity. We do not include any effect arising from black-hole spins.

As done in the previous section, we apply our parameter inference procedure to
these systems using both BAMBI and parallel-tempered MCMC sampling, and we
numerically evaluate the Fisher matrix at the parameters of the injection.

Due to the duration of an SOBH inspiral in the LISA band, and the complete lack
of merger and ringdown, the chirp mass $\Mchirp$ is measured much better than
other mass parameters and the component masses have a much stronger correlation
than usually found with ground-based gravitational-wave detectors. In order for
the sampling to converge robustly in a reasonable time, we find it is necessary
to express the mass parameters in terms of $\Mchirp$ and symmetric mass ratio
$\eta$, and a relatively tight prior around the injected parameters is required
as well.

In order to generate these results, our PTMCMC sampler requires between
$5\times 10^5$ and $3\times 10^6$ steps with 100 temperatures, taking on the
order of days on a single CPU core without careful optimization. The BAMBI
sampling, on the other hand, completes in tens of minutes only.

The resulting posterior distributions are shown in Fig.~\ref{fig:sobh_corner_1}
and \ref{fig:sobh_corner_12}. We find close agreement between the BAMBI and
PTMCMC samplers. The full joint distributions are fairly complex, but the
complexity is mostly restricted to multimodalities and degeneracies in the
angular parameters only. The typical degeneracy between inclination and distance
is evident. Masses, merger time, distance, inclination and sky location, which
are arguably the most astrophysically useful parameters, have simple marginal
distributions with a well-defined mode and close to Gaussian, even at these
moderate SNR values. The Fisher matrix estimates represent the marginal
distributions of these parameters at least to the order of magnitude. In some
cases the Fisher estimates approximate very precisely even the joint
distributions of pairs of these parameters.

\begin{figure*}
	\includegraphics[width=\textwidth]{../plots/corner_sobh_tdc1_ptmcmc_bambi}
	\caption{Inferred parameter posterior distribution for SOBH system 1.}
	\label{fig:sobh_corner_1}
\end{figure*}

\begin{figure*}
	\includegraphics[width=\textwidth]{../plots/corner_sobh_tdc2_ptmcmc_bambi}
	\caption{Inferred parameter posterior distribution for SOBH system 12.}
	\label{fig:sobh_corner_12}
\end{figure*}

Such posterior distributions should not be taken literally as expectations of
LISA's capability for SOBH systems. One reason is the simplified treatment of
the finite observation time described earlier. A second reason is the assumption
of zero black-hole spins, which artificially reduces the width of the posterior
distribution due to the strong degeneracy between spins and symmetric mass
ratio \cite{Baird+2013}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Signals and transfer functions}
\label{subsec:signaltransferSOBH}

\begin{figure*}
  \centering
  \includegraphics[width=.98\linewidth]{../plots/plot_sobh1_tdi.pdf}
  \caption{\SM{TODO: rethink the visualization, maybe plot only transfer functions}.}
  \label{fig:PEsmbh22hmCase0}
\end{figure*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Discussion}
\label{sec:discussion}

- Summary/conclusions


----------------
Other questions:
- special orientations/sky locations ?
- Fisher matrix qualification - explore parameter choices
- continuously increase SNR - include on these examples
- continuously accumulate information over time
- full exploration of parameter space for all of the above...


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\appendix

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Conventions for orbits and frames}
\label{app:conventions}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%\subsection{The LISA response - OLD}
%\label{sec:lisaresponse}
%
%\SM{------------------------------------------------------}
%
%\SM{[copy-paste from previous paper -- just here to copy needed formulas / refs]}
%
%We begin by detailing the model that we use for the response of a LISA-like detector, together with the assumptions used and their limitations. Since our aim is to assess the accuracy of our direct Fourier-domain treatment of the response, we can focus on the gravitational-wave contribution to the basic single-link observables. We therefore use a somewhat simplified model for the time-domain response~\cite{Krolak+04}, ignoring corrections that would be crucial from the point of view of noise cancellations, keeping in mind that the response model can be enriched later without affecting the conclusions of the present analysis.
%
%The frequency-shift response for a single link~\eqref{eq:yslr} was derived in Ref.~\cite{EW75} (see also~\cite{CR02, RCP04, Finn08, Cornish09}). Several assumptions enter the result as written in~\eqref{eq:yslr}: (i) effects of the order $v/c$ are neglected, including for instance the special relativistic Doppler effect created by the relative speeds of the spacecraft on their orbits (ii) the propagation is assumed to take place in a flat spacetime, perturbed only by the gravitational wave; thus the gravitational redshift as well as the deflection of light created by the gravitational potential of the Sun is ignored (iii) all geometric factors are evaluated at a single time, whereas one should consider the beam as propagating from the position of the first spacecraft at the time of emission to the position of the second scapecraft at the time of reception, leading to a point-ahead effect.
%
%Additionally, we limit ourselves to a rigid model for the orbits of the constellation, namely we assume that the constellation remains in an equilateral configuration with fixed armlengths. These simplified orbits neglect (iv) effects of order $e^{2}$ from the eccentricity of the individual Keplerian orbits, (v) the effect of gravitational perturbations coming from other celestial bodies, such as the Earth, the quadrupole of the Sun, and the other planets. Note that although we can neglect all the effects (i)-(v) for our present study, keeping track of these corrections is crucial for the purpose of laser noise cancellations, and led to the development of new generations of TDI observables~\cite{Tintoliving}.
%
%It is natural to split the response~\eqref{eq:yslr} into two steps: first the orbital delay related to the orbit around the Sun of the whole constellation, and then the constellation response. The baselines for the delays are indeed very different in the two cases. Geometrical projection factors aside, we have for the orbit around the Sun $R=1\text{au}=1.5\times 10^{8} \text{km}$, while the detector armlength is $L=2.5\times 10^{6}\text{km}$ (in the configuration proposed in~\cite{LISA17}). It is natural to define two transfer frequencies for the two relevant length scales for the delays, defined such that a wavelength fits within this length scale, i.e. $2\pi f d = 1$. This gives
%\begin{subequations}\label{eq:transferfrequencies}
%\begin{align}
%	f_{R} &= 3.2\times10^{-4}\Hz \,,\\
%	f_{L} &= 1.9\times 10^{-2}\Hz \,.
%\end{align}
%\end{subequations}
%The LISA response will behave qualitatively differently on the three frequency bands $f \leq f_{R}$, $f_{R} \leq f \leq f_{L}$ and $f_{L} \leq f$.
%
%The first stage of the response, the orbital delay, consists simply in applying the varying time delay to bring the wavefront sampling point from the SSB reference to the center of the LISA triangular constellation, common to all $y_{slr}$ observables. For $h^{\rm TT}$ the transverse-traceless gravitational waveform in matrix form, we write this orbital time delay as
%\be\label{eq:defresponse0}
%	h_{0}^{\rm TT} (t) = h^{\rm TT}(t-\hatk\cdot p_{0}) \,,
%\ee
%with $p_{0}$ the position of the constellation center, which follows the Earth orbit around the Sun. The second stage of the response calculation comprises the remaining, constellation-centered response. For the single-link contribution to the response, for the laser link from spacecraft $s$ to spacecraft $r$ along a path in direction $n_l$, we write
%\begin{align}\label{eq:defresponseL}
%	y_{slr} &= \frac{1}{2} \frac{1}{1 - \hatk\cdot n_{l}} \nn\\
%	& \cdot n_{l}\cdot \left[ h_{0}^{\rm TT}(t - L - \hatk\cdot p^{L}_{s}) - h_{0}^{\rm TT}(t - \hatk\cdot p^{L}_{r}) \right] \cdot n_{l}\,,
%\end{align}
%where we reference the positions of the spacecraft relative to the center of the constellation, $p^{L}_{A} \equiv p_{A} - p_{0}$.
%
%As described in App.~\ref{app:notation} We will decompose the full signal in the contributions of the individual spin-weighted spherical modes $h_{\ell m}$, whose Fourier transforms are assumed to have a smooth amplitude and phase. First, we define the matrices $P_{+},P_{\times}$ such that, in the sense of matrices,
%\be
%	h^{\rm TT} = h_{+}P_{+} + h_{\times}P_{\times} \,.
%\ee
%We focus only on positive frequencies. Assuming that the approximation~\eqref{eq:zeronegativef} applies, we consider a single mode contribution, $h=h_{\ell m}$ with $m>0$. For each given mode we define a complex matrix $P_{\ell m}$ incorporating the spin-weighted spherical harmonic constant factor as
%\be
%	P_{\ell m} =
%	\begin{cases}
%	\frac{1}{2} {}_{-2}Y_{\ell m} \left( P_{+} + i P_{\times} \right) \text{ for } m>0\,,\\
%	\frac{1}{2} {}_{-2}Y_{\ell m}^{*} \left( P_{+} - i P_{\times} \right) \text{ for } m<0\,.
%	\end{cases}
%\ee
%
%We now turn to the transformation of~\eqref{eq:defresponse0} and~\eqref{eq:defresponseL} to the Fourier domain. Applying a pure delay as in~\eqref{eq:defresponse0} translates into
%\be\label{eq:G0}
%	G_{0}(f, t) = e^{-2i\pi f d_{0}(t)} \,,
%\ee
%with $d_{0} = -\hatk \cdot p_{0}$ the delay associated to the orbit around the Sun. For the leading-order response~\eqref{eq:transferlocal}, this gives a Fourier-domain transfer function common to all modes, that is a pure phase factor, proportional to the frequency but also $t_{f}$-dependent:
%\be\label{eq:transfer0local}
%	\calT_{0}^{\rm local}(f) = G_{0}(f, \tf)\,.
%\ee
%If $(\lambda, \beta)$ are the ecliptic longitude and latitude of the source in the sky, and if the orbital phase is set by convention to $0$ at $t=0$, the orbital delay has the simple expression
%\be\label{eq:delay0}
%	d_{0}(t) = -R \cos\beta \cos\left(\Omega_{0}t - \lambda\right)\,.
%\ee
%
%For the constellation part of response~\eqref{eq:defresponseL}, treated separately from the delay~\eqref{eq:delay0}, we write
%\begin{align}\label{eq:decomposeGslr}
%	F_{slr}^{L}(t) &= \frac{1}{2} \frac{1}{1 - \hatk\cdot n_{l}(t)} n_{l}(t) \cdot P_{\ell m} \cdot n_{l} (t) \,,\nn\\
%	d_{s}(t) &= - k\cdot p_{s}^{L}(t) \,, \quad d_{r}(t) = - k\cdot p_{r}^{L}(t) \,,\nn\\
%	G_{slr}^{L}(f,t) &=  F_{slr}^{L}(t) \left( e^{-2i\pi f (d_{s,L}(t) + L)} - e^{-2i\pi f d_{r}(t)} \right) \,.
%\end{align}
%The superscript $L$ indicates that the orbital delay~\eqref{eq:delay0} is not included. Since we also assume the rigid approximation for the constellation, where the armlengths are fixed, a particular simplification occurs when combining these individual delays, thanks to the relation $p^{L}_{r} - p^{L}_{s} =  L n_{l}$:
%\begin{align}\label{eq:GslrL}
%	G_{slr}^{L}(f,t) &= \frac{i \pi f L}{2} \sinc \left[ \pi f L\left(1-\hatk\cdot n_{l} \right) \right] \nn\\
%	& \quad \cdot \exp\left[ i \pi f \left( L + \hatk\cdot \left( p_{1}^{L} + p_{2}^{L} \right) \right) \right]  n_{l} \cdot P_{\ell m} \cdot n_{l} \,,
%\end{align}
%with all time-dependent vectors evaluated at $t$. This expression is well known as describing the frequency-dependency in the LISA response~\cite{Larson+99, Cornish01, CR02, RCP04}. In the local approximation~\eqref{eq:transferlocal}, the Fourier-domain transfer function then reads
%\begin{align}\label{eq:transferLlocal}
%	\calT_{slr}^{L, \mathrm{local}}(f) &= G_{slr}^{L}(f, \tf) \,.
%\end{align}
%For plotting purposes, we will also define
%\be\label{eq:transferLenvelope}
%	\overline{\calT}_{slr}^{L} (f) = \frac{i \pi f L}{2} n_{l} \cdot P_{\ell m} \cdot n_{l} (\tf)
%\ee
%which will serve as an estimate for the enveloppe function of the response, devoid of the zero-crossings at high frequencies of the $\sinc$ term in~\eqref{eq:GslrL}.
%
%Note that, if the corrections of Sec.~\ref{subsec:delays}, for non-negligible $\dot d$, are included for the constellation delays, the transfer function will not have this simple form anymore, as $\dot{d}$ will have a different velocity-dependent expression for the sending and receiving spacecraft. One must then separately handle $d_{s}$ and $d_{r}$ in~\eqref{eq:decomposeGslr} to compute the corrections.
%
%The orbital response~\eqref{eq:transfer0local}-\eqref{eq:delay0} takes a simple analytic form, but the phase contribution of this delay is significant across most of the frequency band and can be large for $f \gg f_{R}$.
%
%The constellation response~\eqref{eq:GslrL}-\eqref{eq:transferLlocal} can be interpreted as the Fourier-domain translation of a discrete derivative taken on the waveform. The leading factor in~\eqref{eq:GslrL} shows that the amplitude of the response is proportional to $f$ in the low-frequency limit $f\ll f_{L}$, where the other factors are essentially unity. For $f\gtrsim f_{L}$, the $\sinc$ and the phase of the exponential generate additional structure in the response, including zero-crossings when the projected armlength is an integer number of wavelengths. From~\eqref{eq:transferLlocal}, an expansion for small $f\ll f_{L}$ yields back a Fourier-domain analog of the low-frequency approximation of the response~\cite{Cutler97, RCP04}, which is equivalent to having two LIGO-type interferometers turned by $\pi/4$ and set in motion.
%
%For analysis of the response we need a concrete set of gravitational waveforms. We will use the PhenomD model~\cite{Khan+15,Husa+15}, which provides Fourier-domain inspiral-merger-ringdown waveforms for aligned spins. We refer to App.~\ref{app:precLISA} for a brief discussion of the prospects for applying our formalism for the LISA response to precessing Fourier-domain waveforms.
%
%\SM{------------------------------------------------------}

\SM{update: change of plan}
For completeness, we provide in this Appendix comprehensive definitions and notations for the gravitational wave signal as well as the LISA response. We hope to spare the reader the effort of navigating between the various conventions used in the literature, and to provide a point of reference for future works. Having these definitions at hand will also help us derive the approximations linking the full response to the simplified response that we used in Sec.~\ref{subsec:SMBHPEdegen}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Source frame, wave frame and SSB frame}
\label{sec:wavessbframe}

We first define a source frame $(\hat{x}_{S}, \hat{y}_{S}, \hat{z}_{S})$ associated to the compact binary system emitting gravitational waves. We choose $\hat{z}_{S} = \hat{L}$, the direction of the orbital angular momentum (constant for non-precessing systems). The choice of $\hat{x}_{S}$, $\hat{y}_{S}$ amounts to fixing the phase convention.

Introducing $k$ the wave propagation unit vector going from the source towards the observer, we define the inclination $\iota$ and the observer phase $\varphi$ as its spherical angular coordinates in the source frame, so that in that frame
\be
	k_{S} = (\sin\iota \cos\varphi, \sin\iota \sin\varphi, \cos\iota) \,.
\ee

By convention, for our polarization vectors $p$ and $q$ we will use the spherical coordinate vectors $p = e_{\theta}^{S}$, $q = e_{\phi}^{S}$. In terms of only $\hat{z}_{S}$,
\bsub
\begin{align}
	p &= q \times k \,,\\
	q &= \hat{z}_{S} \times k / |\hat{z}_{S} \times k|\,.
\end{align}
\esub

...

We start by introducing a source frame $(\hat{x}_{S}, \hat{y}_{S}, \hat{z}_{S})$ attached to the binary system emitting gravitational waves. Relating this frame to the physical configuration of the binary is understood as being part of the waveform model. For comparable-mass systems without spin or with aligned spins\footnote{For precessing systems, different choices are possible, like $\hat{z}_{S} = \hat{J}$, the direction of the total angular momentum.}, the natural choice is to take the normal to the orbital plane as $\hat{z}_{S}$, and we will assume that the remaining rotation around $\hat{z}_{S}$ is fixed by the phase convention of the waveform model (fixing the waveform phase at a reference frequency, or fixing the orbital phase at a reference time, see Sec.~\ref{} \SM{...}).

Introducing $k$ the wave propagation unit vector going from the source towards the observer, we define the inclination $\iota$ and the observer phase $\varphi$ as its spherical angular coordinates in the source frame, so that in that frame
\be
	k_{S} = (\sin\iota \cos\varphi, \sin\iota \sin\varphi, \cos\iota) \,.
\ee

By convention, for our polarization vectors $p$ and $q$ we will use the spherical coordinate vectors $p = e_{\theta}^{S}$, $q = e_{\phi}^{S}$. In terms of only $\hat{z}_{S}$,
\bsub
\begin{align}
	p &= q \times k \,,\\
	q &= \hat{z}_{S} \times k / |\hat{z}_{S} \times k|\,.
\end{align}
\esub

The vectors $(p,q,k)$ form the wave frame, such that the gravitational wave takes in this frame the familiar form
\be
	H_{W} = \begin{pmatrix}
		h_{+} & h_{\times} & 0 \\
		h_{\times} & -h_{+} & 0 \\
		0 & 0 & 0
		\end{pmatrix} \,.
\ee

We can now relate the wave frame to a detector frame $(\hat{x}, \hat{y}, \hat{z})$, which will fix our convention for the sky position and polarization angle. We choose here this detector frame to be based on the plane of ecliptic, and centered on the Solar System Barycenter; we will call this frame the SSB frame. Below, we will introduce another detector frame more suitable for short-lived signals, the LISA frame.

The source position in the sky is given by $(\lambda, \beta)$, the ecliptic longitude and latitude in this SSB-frame. Like with the source frame, we can introduce spherical vectors $(e_{r}^{SSB}, e_{\theta}^{SSB}, e_{\phi}^{SSB})$. Since the propagation vector is $k = - e_{r}^{SSB}$,
\be
	k = (- \cos\beta\cos\lambda, - \cos\beta\sin\lambda, -\sin\beta) \,.
\ee

The last degree of freedom between the frames represents a rotation along the line-of-sight, parametrized by the polarization angle $\psi$. We introduce reference polarization vectors in the SSB-frame as
\bsub
\begin{align}
	u &= \hat{z} \times k / |\hat{z} \times k| \,,\\
	v &= k \times u \,.
\end{align}
\esub
In terms of spherical vectors, $(k, u, v) = (-e_{r}^{SSB}, -e_{\phi}^{SSB}, -e_{\theta}^{SSB})$.

In the following, we will use the notation $R(v,\varpi)$ to denote the matrix of an active rotation around the vector $v$ by an angle $\varpi$. The polarization angle $\psi$ is then defined such that $(p,q)$ are obtained by rotating $(u,v)$ by the angle $\psi$ around $k$, i.e.
\be
	(p,q) = R(k, \psi) \cdot (u,v) \,.
\ee

These relations can be summarized by the active rotation matrix $R_{W}$ from the SSB-frame to the wave frame:
\be\label{eq:RW}
	R_{W} = R(z, \lambda - \pi/2) \cdot R(x, \beta + \pi/2 ) \cdot R(z, \psi)\,.
\ee

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{LISA trajectories}
\label{sec:lisatraj}

The orbits of the three spacecrafts around the Sun can be chosen so that, at leading order in the eccentricity of the orbits, the constellation retains the shape of an equilateral triangle in a cartwheeling motion following the Earth orbit. We denote by $a$ the semi-major axis, $e$ the eccentricity and pose $\alpha = \Omega_{0} (t-t_{0}))$, with $t_{0}$ a reference time for the initial position ($t_{0} = 0$ in our case). The reference SSB frame is $(\hat{x}, \hat{y}, \hat{z})$.

Using the notation $c,s = \cos, \sin \alpha$, the trajectory of the center of the constellation is simply
\be
	p_{0} = ac \hat{x} + as \hat{y} \,,
\ee
and we take $a\equiv R = 1 \, \mathrm{au}$. We denote the positions of the spacecrafts as $p_{A}$ for $A=1,2,3$, and the positions relative to the constellation center as $p_{A}^{L} = p_{A} - p_{0}$. Setting $\beta_{A} = 2(A-1)\pi/3 + \beta_{0}$ (with $\beta_{0}$ and initial condition set to 0 in our case), the Cartesian coordinates in the SSB-frame of the position of the spacecrafts read~\cite{}
\bsub
\begin{align}
	p_{A}^{L} &= a e \left[ \sin \beta_{A} c s - \cos\beta_{A} \left( 1 + s^{2} \right) \right] \hat{x} \nn\\
	& + a e \left[ \cos \beta_{A} c s - \sin\beta_{A} \left( 1 + c^{2} \right) \right] \hat{y} \nn\\
	& - a e \sqrt{3} \cos(\alpha - \beta_{A}) \hat{z} \,,
\end{align}
\esub
The armlength, constant in this approximation, is related to the eccentricity and semi-major axis by
\be
	L = 2\sqrt{3} a e \,.
\ee
The rigid approximation for the constellation, at first order in $e$, can be seen as a first-order approximation in the small parameter $L/R \simeq 0.017$ for a $2.5 \, \mathrm{Gm}$ armlength~\cite{}.

\TDC{Something is incorrect in this discussion. From (A11) and the definition of $a$ above, it sounds like the armlength is longer than 1 au.}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{The LISA frame}
\label{sec:LISAframe}

It will be very useful to introduce a time-dependent frame $(\hat{x}_{L}, \hat{y}_{L}, \hat{z}_{L})(t)$ following the detector in its motion. Specifically, we choose this LISA frame (L-frame for short) such that at any time,
\bsub
\begin{align}
	p_{1}^{L} &= - \frac{L}{\sqrt{3}} \hat{x}_{L} \,,\\
	p_{2}^{L} &= \frac{L}{2\sqrt{3}} \hat{x}_{L} - \frac{L}{2} \hat{y}_{L} \,,\\
	p_{3}^{L} &= \frac{L}{2\sqrt{3}} \hat{x}_{L} + \frac{L}{2} \hat{y}_{L} \,.\\
\end{align}
\esub

This frame also provides us with an equivalent representation of the trajectories making use of rotation matrices. Since in our rigid approximation the constellation remains an equilateral triangle in its cartwheeling motion around the Sun, the configuration of the constellation at a later time is given by a rotation around the Sun composed with a rotation of the constellation around its symmetry axis.

If we denote by $R_{L}$ the active rotation from the SSB-frame to the L-frame such that for each of the three basis vectors $(\hat{x}_{L}, \hat{y}_{L}, \hat{z}_{L}) = R_{L} (\hat{x}, \hat{y}, \hat{z})$, we have
\be\label{eq:RL}
	R_{L} = R(z, \alpha) \cdot R(y, -\pi/3) \cdot R(z, -\alpha) \,,
\ee
where we recall that $\alpha = \Omega_{0} (t-t_{0}) $. For all vectors $X$ among $p_{A}^{L}$, $n_{A}$ we have $X(t) = R_{L} \cdot X(t=t_{0})$. If a vector $X$ is given by its components in the SSB-frame, in the L-frame the components are $X_{L} = R_{L}^{-1} \cdot X$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Parametrizing the signal in the LISA-frame}
\label{sec:LISAframeparams}

While long-lasting signals like SOBHs will see a strong imprint of the LISA orbital motion over the course of observation, SMBH signals are dominated in SNR by a short-lived burst of emission at merger. For such signals, it will be useful to use a parametrization based on the LISA frame at the time of merger instead of the SSB frame.

The new parameters are defined as playing the same role as the SSB parameters, but relative to the L-frame. Namely, we define $R_{LW}$ the active rotation matrix from the L-frame to the wave frame, expressed in the L-frame basis, so that for each basis vector expressed in the L-frame basis $(\hat{x}_{W}, \hat{y}_{W}, \hat{z}_{W})_{L} = R_{LW} \cdot (\hat{x}_{L}, \hat{y}_{L}, \hat{z}_{L})_{L}$. The defining condition on $(\lambda_{L}, \beta_{L}, \psi_{L})$ is
\be\label{eq:defRLW}
	R_{LW} = R(z, \lambda_{L} - \pi/2) \cdot R(x, \beta_{L} + \pi/2 ) \cdot R(z, \psi_{L}) \,.
\ee

Coming back to vectors expressed in the SSB-basis, $R_{L}^{-1} \cdot (\hat{x}_{W}, \hat{y}_{W}, \hat{z}_{W}) = R_{LW} \cdot R_{L}^{-1} \cdot (\hat{x}_{L}, \hat{y}_{L}, \hat{z}_{L})$. Since $ (\hat{x}_{W}, \hat{y}_{W}, \hat{z}_{W}) = R_{W} \cdot (\hat{x}, \hat{y}, \hat{z})$ and $ (\hat{x}_{L}, \hat{y}_{L}, \hat{z}_{L}) = R_{L} \cdot (\hat{x}, \hat{y}, \hat{z})$, we arrive at
\be\label{eq:RLW}
	R_{LW} = R_{L}^{-1} \cdot R_{W} \,.
\ee

Combining~\eqref{eq:RLW}, \eqref{eq:RL}, \eqref{eq:RW} and~\eqref{eq:defRLW} yields the following expressions for the L-frame angular parameters\footnote{The convention here is that the point of coordinates $(x,y)$ in the plane has for argument $\arctan\left[ x, y \right]$.}:
\bsub\label{eq:Lframeangles}
\begin{align}
	\beta_{L} &= \arcsin \left[ \cos \frac{\pi}{3} \sin \beta - \sin \frac{\pi}{3} \cos \beta \cos \left( \lambda - \alpha \right) \right] \,,\\
	\lambda_{L} &= \arctan \left[ \cos\beta \cos\lambda \left( \cos \frac{\pi}{3} \cos^{2}\alpha + \sin^{2}\alpha \right) \right. \nn\\
	& \qquad\quad\;\; \left. + \cos\beta \sin\lambda \cos\alpha \sin\alpha \left( \cos\frac{\pi}{3} - 1 \right) \right. \nn\\
	& \qquad\quad\;\; \left. + \sin\frac{\pi}{3} \sin\beta \cos\alpha , \right. \nn\\
	& \qquad\qquad\; \left. \cos\beta \sin\lambda \left( \cos \frac{\pi}{3} \sin^{2}\alpha + \cos^{2}\alpha \right) \right. \nn\\
	& \qquad\quad\;\; \left. + \cos\beta \cos\lambda \cos\alpha \sin\alpha \left( \cos\frac{\pi}{3} - 1 \right) \right. \nn\\
	& \qquad\quad\;\; \left. + \sin\frac{\pi}{3} \sin\beta \sin\alpha \right] \,,\\
%	\psi_{L} &= \arctan \left[ \cos\psi \left( \cos\frac{\pi}{3}\cos\beta + \sin\frac{\pi}{3} \sin\beta \cos(\lambda - \alpha)\right) \right. \nn\\
%	& \qquad\quad\;\; \left. + \sin \psi \sin\frac{\pi}{3} \sin(\lambda - \alpha), \right. \nn\\
%	& \qquad\qquad\; \left. \sin\psi \left( \cos\frac{\pi}{3}\cos\beta + \sin\frac{\pi}{3} \sin\beta \cos(\lambda - \alpha)\right) \right. \nn\\
%	& \qquad\quad\;\; \left. - \cos \psi \sin\frac{\pi}{3} \sin(\lambda - \alpha) \right] \,.
	\psi_{L} &= \psi + \arctan \left[\cos\frac{\pi}{3}\cos\beta + \sin\frac{\pi}{3} \sin\beta \cos(\lambda - \alpha), \right. \nn\\
	&\qquad\qquad\quad\;\; \left.-\sin \frac{\pi}{3} \sin(\lambda - \alpha) \right] \,.
%gwtools.modpi(psiSSB + arctan2(coslambda*sinalpha*sinzeta -cosalpha*sinzeta*sinlambda, cosbeta*coszeta + cosalpha*coslambda*sinbeta*sinzeta + sinalpha*sinbeta*sinzeta*sinlambda))
\end{align}
\esub
Through $\alpha = \Omega_{0} (t-t_{0}) $, these expressions are time-dependent, reflecting the rotation of this frame to follow LISA on its orbit.

The definition of the reference phase $\phi_{\rm Ref}$, \dots \SM{[COMPLETE]}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Numerical integration with spline-interpolated phases}
\label{app:numintegration}

[describe implementation of 0-noise integrals]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Reduced-order model for EOBNRv2HMROM}
\label{sec:rom}

[describe implementation of the ROM]

\begin{figure}
  \centering
  \includegraphics[width=.99\linewidth]{../plots/plot_MM_ROM.pdf}
  \caption{Unfaithfulness of ROM waveforms compared to the original EOBNRv2HM waveforms, computed as in~\eqref{}. We show here the results for the orientations \SM{[complete]}, for 200 random mass ratio values between 1 and 12, for masses $10 \Msol$, $50 \Msol$ and $250 \Msol$. The inclination angle is $\iota = \pi/2$, maximizing the effect of higher harmonics.}
  \label{fig:MMROM}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Sampling the fully degenerate extrinsic posterior}
\label{app:samplingdegen}

\begin{figure*}
  \centering
  \includegraphics[width=.8\linewidth]{../plots/corner_smbh_case9_simplelike_ptmcmc_bambi.png}
  \caption{Posterior distributions obtained with the two samplers \texttt{PTMCMC} (blue) and $\texttt{MultiNest}$ (green) for the simplified likelihood~\eqref{eq:simplelikelihoodhm}, using only the dominant mode $(\ell, m) = (2,2)$. Masses and time are pinned to the injected value, and the motion of the detector is neglected. We also superimpose (red) the contours obtained with \texttt{MultiNest} by including all harmonics $(2,2)$, $(2,1)$, $(3,3)$, $(4,4)$, $(5,5)$.}
  \label{fig:PEsmbh22hmSimpleLikeCase9}
\end{figure*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\section{SNR dependence of parameter estimation}
%\label{sec:SMBHPEdistance}
%
%-- show series of analyses varying only the distance/SNR
%
%\begin{figure*}
%  \centering
%  \begin{minipage}{.32\linewidth}
%      \includegraphics[width=.99\linewidth]{../plots/corner_smbh_case9_hm_dseries_m1m2.png}
%   \end{minipage}
%   \begin{minipage}{.32\linewidth}
%      \includegraphics[width=.99\linewidth]{../plots/corner_smbh_case9_hm_dseries_Dinc.png}
%   \end{minipage}
%   \begin{minipage}{.32\linewidth}
%      \includegraphics[width=.99\linewidth]{../plots/corner_smbh_case9_hm_dseries_tphi.png}
%   \end{minipage}
%  \caption{.}
%  \label{fig:smbhCornerZoomHMCase9}
%\end{figure*}
%
%\begin{figure*}
%  \centering
%  \includegraphics[width=.8\linewidth]{../plots/plot_mollweide_dseries.png}
%  \caption{.}
%  \label{fig:MollweidesmbhTserieshmCase9}
%\end{figure*}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{acknowledgments}

TDC was supported by an appointment to the NASA Postdoctoral Program at the
Goddard Space Flight Center, administered by Universities Space Research
Association under contract with NASA.

\end{acknowledgments}

\bibliography{references.bib}

\end{document}
